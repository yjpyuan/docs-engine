"use strict";(globalThis.webpackChunkw3bank_knowledge_wiki=globalThis.webpackChunkw3bank_knowledge_wiki||[]).push([[7538],{3856(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"L0-enterprise/standards/testing-standards","title":"\u6d4b\u8bd5\u89c4\u8303","description":"\u4f01\u4e1a\u7ea7\u6d4b\u8bd5\u57fa\u7ebf\uff0c\u9002\u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\u3001\u96c6\u6210\u6d4b\u8bd5\u3001\u63a5\u53e3\u6d4b\u8bd5\u3001\u6027\u80fd\u6d4b\u8bd5\u573a\u666f","source":"@site/docs/L0-enterprise/standards/testing-standards.md","sourceDirName":"L0-enterprise/standards","slug":"/L0-enterprise/standards/testing-standards","permalink":"/docs-engine/docs/L0-enterprise/standards/testing-standards","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/L0-enterprise/standards/testing-standards.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Python Project Scaffolding","permalink":"/docs-engine/docs/L0-enterprise/standards/python/python-scaffold"},"next":{"title":"\u6280\u672f\u96f7\u8fbe - \u91c7\u7528\uff08Adopt\uff09","permalink":"/docs-engine/docs/L0-enterprise/technology-radar/adopt"}}');var t=r(4848),d=r(8453);const i={},a="\u6d4b\u8bd5\u89c4\u8303",l={},c=[{value:"\u4e00\u3001\u6d4b\u8bd5\u5206\u5c42\u89c4\u8303 [MUST]",id:"\u4e00\u6d4b\u8bd5\u5206\u5c42\u89c4\u8303-must",level:2},{value:"1.1 \u6d4b\u8bd5\u5c42\u7ea7",id:"11-\u6d4b\u8bd5\u5c42\u7ea7",level:3},{value:"1.2 \u8986\u76d6\u7387\u8981\u6c42",id:"12-\u8986\u76d6\u7387\u8981\u6c42",level:3},{value:"\u4e8c\u3001\u5355\u5143\u6d4b\u8bd5\u89c4\u8303 [MUST]",id:"\u4e8c\u5355\u5143\u6d4b\u8bd5\u89c4\u8303-must",level:2},{value:"2.1 \u6838\u5fc3\u539f\u5219",id:"21-\u6838\u5fc3\u539f\u5219",level:3},{value:"2.2 Mock \u89c4\u8303",id:"22-mock-\u89c4\u8303",level:3},{value:"2.3 \u7981\u6b62\u9879",id:"23-\u7981\u6b62\u9879",level:3},{value:"\u4e09\u3001\u6d4b\u8bd5\u5e42\u7b49\u6027\u89c4\u8303 [MUST]",id:"\u4e09\u6d4b\u8bd5\u5e42\u7b49\u6027\u89c4\u8303-must",level:2},{value:"3.1 \u6838\u5fc3\u539f\u5219",id:"31-\u6838\u5fc3\u539f\u5219",level:3},{value:"3.2 \u6570\u636e\u7ba1\u7406",id:"32-\u6570\u636e\u7ba1\u7406",level:3},{value:"3.3 \u7981\u6b62\u9879",id:"33-\u7981\u6b62\u9879",level:3},{value:"\u56db\u3001\u96c6\u6210\u6d4b\u8bd5\u89c4\u8303 [MUST]",id:"\u56db\u96c6\u6210\u6d4b\u8bd5\u89c4\u8303-must",level:2},{value:"4.1 Testcontainers \u4f7f\u7528",id:"41-testcontainers-\u4f7f\u7528",level:3},{value:"3.2 \u6570\u636e\u9694\u79bb",id:"32-\u6570\u636e\u9694\u79bb",level:3},{value:"\u4e94\u3001\u63a5\u53e3\u6d4b\u8bd5\u89c4\u8303 [MUST]",id:"\u4e94\u63a5\u53e3\u6d4b\u8bd5\u89c4\u8303-must",level:2},{value:"5.1 RestAssured \u6d4b\u8bd5",id:"51-restassured-\u6d4b\u8bd5",level:3},{value:"4.2 \u8986\u76d6\u573a\u666f",id:"42-\u8986\u76d6\u573a\u666f",level:3},{value:"\u516d\u3001\u6027\u80fd\u6d4b\u8bd5\u89c4\u8303 [SHOULD]",id:"\u516d\u6027\u80fd\u6d4b\u8bd5\u89c4\u8303-should",level:2},{value:"6.1 \u6d4b\u8bd5\u6307\u6807",id:"61-\u6d4b\u8bd5\u6307\u6807",level:3},{value:"5.2 \u6d4b\u8bd5\u73af\u5883",id:"52-\u6d4b\u8bd5\u73af\u5883",level:3},{value:"5.3 JMeter \u914d\u7f6e",id:"53-jmeter-\u914d\u7f6e",level:3},{value:"\u4e03\u3001CI/CD \u96c6\u6210\u89c4\u8303 [MUST]",id:"\u4e03cicd-\u96c6\u6210\u89c4\u8303-must",level:2},{value:"7.1 \u6d41\u6c34\u7ebf\u914d\u7f6e",id:"71-\u6d41\u6c34\u7ebf\u914d\u7f6e",level:3},{value:"6.2 \u8d28\u91cf\u95e8\u7981",id:"62-\u8d28\u91cf\u95e8\u7981",level:3},{value:"\u516b\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",id:"\u516b\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u6d4b\u8bd5\u89c4\u8303",children:"\u6d4b\u8bd5\u89c4\u8303"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u4f01\u4e1a\u7ea7\u6d4b\u8bd5\u57fa\u7ebf\uff0c\u9002\u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\u3001\u96c6\u6210\u6d4b\u8bd5\u3001\u63a5\u53e3\u6d4b\u8bd5\u3001\u6027\u80fd\u6d4b\u8bd5\u573a\u666f"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e00\u6d4b\u8bd5\u5206\u5c42\u89c4\u8303-must",children:"\u4e00\u3001\u6d4b\u8bd5\u5206\u5c42\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"11-\u6d4b\u8bd5\u5c42\u7ea7",children:"1.1 \u6d4b\u8bd5\u5c42\u7ea7"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5c42\u7ea7"}),(0,t.jsx)(n.th,{children:"\u6838\u5fc3\u76ee\u6807"}),(0,t.jsx)(n.th,{children:"\u8986\u76d6\u8303\u56f4"}),(0,t.jsx)(n.th,{children:"\u5de5\u5177\u9009\u578b"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5355\u5143\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u9a8c\u8bc1\u5355\u4e2a\u7c7b/\u65b9\u6cd5\u903b\u8f91"}),(0,t.jsx)(n.td,{children:"Service \u6838\u5fc3\u903b\u8f91 \u226580%"}),(0,t.jsx)(n.td,{children:"JUnit5 + Mockito"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u96c6\u6210\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u9a8c\u8bc1\u4f9d\u8d56\u534f\u4f5c"}),(0,t.jsx)(n.td,{children:"DB + Redis + \u8de8\u670d\u52a1"}),(0,t.jsx)(n.td,{children:"JUnit5 + Testcontainers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5951\u7ea6\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u9a8c\u8bc1\u670d\u52a1\u95f4\u63a5\u53e3\u5951\u7ea6"}),(0,t.jsx)(n.td,{children:"\u6240\u6709\u5bf9\u5916 API"}),(0,t.jsx)(n.td,{children:"Spring Cloud Contract"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u63a5\u53e3\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u9a8c\u8bc1 HTTP \u63a5\u53e3"}),(0,t.jsx)(n.td,{children:"\u6240\u6709\u5bf9\u5916\u63a5\u53e3 100%"}),(0,t.jsx)(n.td,{children:"RestAssured"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u6027\u80fd\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u9a8c\u8bc1\u9ad8\u5e76\u53d1\u7a33\u5b9a\u6027"}),(0,t.jsx)(n.td,{children:"\u6838\u5fc3\u63a5\u53e3"}),(0,t.jsx)(n.td,{children:"JMeter / Gatling"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"12-\u8986\u76d6\u7387\u8981\u6c42",children:"1.2 \u8986\u76d6\u7387\u8981\u6c42"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"coverage:\n  service_layer: 80%   # Service \u5c42\u6838\u5fc3\u903b\u8f91\n  dao_layer: 50%       # Dao \u5c42\n  controller_layer: 60%\n  overall: 70%\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e8c\u5355\u5143\u6d4b\u8bd5\u89c4\u8303-must",children:"\u4e8c\u3001\u5355\u5143\u6d4b\u8bd5\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"21-\u6838\u5fc3\u539f\u5219",children:"2.1 \u6838\u5fc3\u539f\u5219"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"principles:\n  - \u9694\u79bb\u5916\u90e8\u4f9d\u8d56\uff08DB\u3001Redis\u3001HTTP\uff09\n  - \u8986\u76d6\u6b63\u5e38 + \u5f02\u5e38 + \u8fb9\u754c\u573a\u666f\n  - \u53ef\u91cd\u590d\u6267\u884c\n  - \u547d\u540d\u89c4\u8303\uff1a\u65b9\u6cd5\u540d_\u573a\u666f_\u9884\u671f\u7ed3\u679c\n"})}),"\n",(0,t.jsx)(n.h3,{id:"22-mock-\u89c4\u8303",children:"2.2 Mock \u89c4\u8303"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\nclass OrderServiceTest {\n    @Autowired\n    private OrderService orderService;\n\n    @MockBean\n    private OrderMapper orderMapper;\n\n    @MockBean\n    private UserFeignApi userFeignApi;\n\n    @MockBean\n    private RedisTemplate<String, String> redisTemplate;\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u6b63\u5e38\u573a\u666f\n    @Test\n    void createOrder_ValidParams_ReturnOrderId() {\n        // Arrange - \u51c6\u5907 Mock \u6570\u636e\n        when(userFeignApi.getUserById(1001L)).thenReturn(Result.success(mockUser));\n        when(redisTemplate.opsForValue().get("stock:2001")).thenReturn("10");\n        when(orderMapper.insert(any(Order.class))).thenReturn(1);\n\n        // Act - \u6267\u884c\u6d4b\u8bd5\u65b9\u6cd5\n        Long orderId = orderService.createOrder(validRequest);\n\n        // Assert - \u65ad\u8a00\u7ed3\u679c\n        assertNotNull(orderId);\n        verify(orderMapper, times(1)).insert(any(Order.class));\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u5f02\u5e38\u573a\u666f\n    @Test\n    void createOrder_UserNotFound_ThrowServiceException() {\n        when(userFeignApi.getUserById(1001L)).thenReturn(Result.success(null));\n\n        ServiceException exception = assertThrows(ServiceException.class, () -> {\n            orderService.createOrder(validRequest);\n        });\n\n        assertEquals("\u7528\u6237\u4e0d\u5b58\u5728", exception.getMessage());\n        verifyNoInteractions(orderMapper);  // \u9a8c\u8bc1 Mapper \u672a\u88ab\u8c03\u7528\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u8fb9\u754c\u573a\u666f\n    @Test\n    void createOrder_StockZero_ThrowServiceException() {\n        when(userFeignApi.getUserById(1001L)).thenReturn(Result.success(mockUser));\n        when(redisTemplate.opsForValue().get("stock:2001")).thenReturn("0");\n\n        assertThrows(ServiceException.class, () -> {\n            orderService.createOrder(validRequest);\n        });\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"23-\u7981\u6b62\u9879",children:"2.3 \u7981\u6b62\u9879"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"prohibited:\n  - \u5355\u5143\u6d4b\u8bd5\u4f9d\u8d56\u771f\u5b9e DB/Redis\n  - \u6d4b\u8bd5\u7528\u4f8b\u4e4b\u95f4\u6709\u4f9d\u8d56\n  - \u53ea\u6d4b\u8bd5\u6b63\u5e38\u573a\u666f\n  - \u541e\u5f02\u5e38\u4e0d\u65ad\u8a00\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"// \u274c \u9519\u8bef\uff1a\u4f9d\u8d56\u771f\u5b9e\u6570\u636e\u5e93\n@Test\nvoid testCreateOrder() {\n    Order order = orderMapper.selectById(1L);  // \u4f9d\u8d56\u771f\u5b9e DB\n    assertNotNull(order);\n}\n\n// \u274c \u9519\u8bef\uff1a\u53ea\u65ad\u8a00\u4e0d\u629b\u5f02\u5e38\n@Test\nvoid testCreateOrder() {\n    try {\n        orderService.createOrder(null);\n    } catch (Exception e) {\n        // \u541e\u5f02\u5e38\uff0c\u6d4b\u8bd5\u6c38\u8fdc\u901a\u8fc7\n    }\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e09\u6d4b\u8bd5\u5e42\u7b49\u6027\u89c4\u8303-must",children:"\u4e09\u3001\u6d4b\u8bd5\u5e42\u7b49\u6027\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"31-\u6838\u5fc3\u539f\u5219",children:"3.1 \u6838\u5fc3\u539f\u5219"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"idempotency_rules:\n  - \u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u5fc5\u987b\u72ec\u7acb\u6267\u884c\n  - \u6d4b\u8bd5\u6267\u884c\u987a\u5e8f\u4e0d\u5f71\u54cd\u7ed3\u679c\n  - \u91cd\u590d\u6267\u884c\u6d4b\u8bd5\u5fc5\u987b\u5f97\u5230\u76f8\u540c\u7ed3\u679c\n"})}),"\n",(0,t.jsx)(n.h3,{id:"32-\u6570\u636e\u7ba1\u7406",children:"3.2 \u6570\u636e\u7ba1\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"@SpringBootTest\nclass OrderServiceTest {\n    @BeforeEach\n    void setUp() {\n        orderMapper.delete(new QueryWrapper<>());  // \u6e05\u7406\u6570\u636e\n        // \u63d2\u5165\u6d4b\u8bd5\u57fa\u7840\u6570\u636e\n    }\n\n    @AfterEach\n    void tearDown() {\n        orderMapper.delete(new QueryWrapper<>());  // \u6e05\u7406\u6570\u636e\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"33-\u7981\u6b62\u9879",children:"3.3 \u7981\u6b62\u9879"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"prohibited:\n  - \u4f7f\u7528\u56fa\u5b9a ID \u4f5c\u4e3a\u6d4b\u8bd5\u6570\u636e\n  - \u4f9d\u8d56\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f\n  - \u4e0d\u6e05\u7406\u6d4b\u8bd5\u4ea7\u751f\u7684\u6570\u636e\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u56db\u96c6\u6210\u6d4b\u8bd5\u89c4\u8303-must",children:"\u56db\u3001\u96c6\u6210\u6d4b\u8bd5\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"41-testcontainers-\u4f7f\u7528",children:"4.1 Testcontainers \u4f7f\u7528"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\n@Testcontainers\nclass OrderServiceIntegrationTest {\n\n    @Container\n    static MySQLContainer<?> mysqlContainer = new MySQLContainer<>("mysql:8.0")\n            .withDatabaseName("test_order_db")\n            .withUsername("test")\n            .withPassword("test123");\n\n    @Container\n    static GenericContainer<?> redisContainer = new GenericContainer<>("redis:6.2")\n            .withExposedPorts(6379);\n\n    @DynamicPropertySource\n    static void registerProperties(DynamicPropertyRegistry registry) {\n        registry.add("spring.datasource.url", mysqlContainer::getJdbcUrl);\n        registry.add("spring.datasource.username", mysqlContainer::getUsername);\n        registry.add("spring.datasource.password", mysqlContainer::getPassword);\n        registry.add("spring.redis.host", redisContainer::getHost);\n        registry.add("spring.redis.port", redisContainer::getFirstMappedPort);\n    }\n\n    @BeforeEach\n    void setUp() {\n        // \u521d\u59cb\u5316\u6d4b\u8bd5\u6570\u636e\n        ScriptUtils.executeSqlScript(dataSource.getConnection(),\n            new ClassPathResource("sql/schema.sql"));\n        redisTemplate.opsForValue().set("stock:2001", "10");\n    }\n\n    @AfterEach\n    void tearDown() {\n        // \u6e05\u7406\u6d4b\u8bd5\u6570\u636e\n        orderMapper.delete(new QueryWrapper<>());\n        redisTemplate.delete("stock:2001");\n    }\n\n    @Test\n    void testCreateOrder_RealDependencies_Success() {\n        Long orderId = orderService.createOrder(validRequest);\n\n        assertNotNull(orderId);\n        // \u9a8c\u8bc1\u6570\u636e\u5e93\n        Order order = orderMapper.selectById(orderId);\n        assertEquals(1001L, order.getUserId());\n        // \u9a8c\u8bc1 Redis\n        assertEquals("8", redisTemplate.opsForValue().get("stock:2001"));\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"32-\u6570\u636e\u9694\u79bb",children:"3.2 \u6570\u636e\u9694\u79bb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - \u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u6570\u636e\u72ec\u7acb\n  - @BeforeEach \u521d\u59cb\u5316\u6570\u636e\n  - @AfterEach \u6e05\u7406\u6570\u636e\n  - \u7981\u6b62\u6d4b\u8bd5\u95f4\u5171\u4eab\u6570\u636e\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e94\u63a5\u53e3\u6d4b\u8bd5\u89c4\u8303-must",children:"\u4e94\u3001\u63a5\u53e3\u6d4b\u8bd5\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"51-restassured-\u6d4b\u8bd5",children:"5.1 RestAssured \u6d4b\u8bd5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\nclass OrderControllerTest {\n    @LocalServerPort\n    private int port;\n\n    @BeforeEach\n    void setUp() {\n        RestAssured.baseURI = "http://localhost";\n        RestAssured.port = port;\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u6b63\u5e38\u573a\u666f\n    @Test\n    void testCreateOrder_Success() {\n        given()\n            .contentType(ContentType.JSON)\n            .body("""\n                {\n                    "userId": 1001,\n                    "goodsList": [{"goodsId": 2001, "quantity": 2}],\n                    "amount": 200\n                }\n            """)\n        .when()\n            .post("/api/v1/orders")\n        .then()\n            .statusCode(200)\n            .body("code", equalTo(200))\n            .body("data", notNullValue());\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u6743\u9650\u573a\u666f\n    @Test\n    void testUpdateOrder_UnLogin_Fail() {\n        given()\n            .contentType(ContentType.JSON)\n            .body("{\\"orderId\\": 3001, \\"status\\": 2}")\n        .when()\n            .post("/api/v1/orders/status")\n        .then()\n            .statusCode(200)\n            .body("code", equalTo(401))\n            .body("msg", equalTo("\u672a\u767b\u5f55"));\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5\u5e42\u7b49\u6027\n    @Test\n    void testCreateOrder_DuplicateRequest_Idempotent() {\n        String requestId = "test-123456";\n\n        for (int i = 0; i < 2; i++) {\n            given()\n                .contentType(ContentType.JSON)\n                .header("X-Request-Id", requestId)\n                .body(validRequestJson)\n            .when()\n                .post("/api/v1/orders")\n            .then()\n                .statusCode(200)\n                .body("data", equalTo(3001));\n        }\n\n        verify(orderService, times(1)).createOrder(any());\n    }\n\n    // \u2705 \u6b63\u786e\uff1a\u6d4b\u8bd5 SQL \u6ce8\u5165\u9632\u62a4\n    @Test\n    void testQueryOrder_SqlInjection_Fail() {\n        given()\n            .pathParam("orderId", "3001\' OR \'1\'=\'1")\n        .when()\n            .get("/api/v1/orders/{orderId}")\n        .then()\n            .statusCode(400)\n            .body("msg", containsString("\u975e\u6cd5\u53c2\u6570"));\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"42-\u8986\u76d6\u573a\u666f",children:"4.2 \u8986\u76d6\u573a\u666f"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"scenarios:\n  - \u6b63\u5e38\u8bf7\u6c42\n  - \u53c2\u6570\u6821\u9a8c\u5931\u8d25\n  - \u6743\u9650\u6821\u9a8c\u5931\u8d25\n  - \u4e1a\u52a1\u5f02\u5e38\n  - \u5e42\u7b49\u6027\n  - SQL \u6ce8\u5165\u9632\u62a4\n  - XSS \u9632\u62a4\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u516d\u6027\u80fd\u6d4b\u8bd5\u89c4\u8303-should",children:"\u516d\u3001\u6027\u80fd\u6d4b\u8bd5\u89c4\u8303 [SHOULD]"}),"\n",(0,t.jsx)(n.h3,{id:"61-\u6d4b\u8bd5\u6307\u6807",children:"6.1 \u6d4b\u8bd5\u6307\u6807"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"metrics:\n  qps: \u76ee\u6807 QPS\uff08\u5982 2000\uff09\n  rt_p99: P99 \u54cd\u5e94\u65f6\u95f4\uff08\u5982 200ms\uff09\n  rt_p95: P95 \u54cd\u5e94\u65f6\u95f4\uff08\u5982 100ms\uff09\n  error_rate: \u9519\u8bef\u7387\uff08<0.1%\uff09\n  resource:\n    cpu: <80%\n    memory: <85%\n    gc_pause: <100ms\n"})}),"\n",(0,t.jsx)(n.h3,{id:"52-\u6d4b\u8bd5\u73af\u5883",children:"5.2 \u6d4b\u8bd5\u73af\u5883"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - \u9884\u53d1\u73af\u5883\u6267\u884c\uff08\u4e0e\u751f\u4ea7\u914d\u7f6e\u4e00\u81f4\uff09\n  - \u6e05\u7406\u5386\u53f2\u6570\u636e\n  - \u76d1\u63a7 JVM \u6307\u6807\n  - \u6301\u7eed\u538b\u6d4b 30 \u5206\u949f\n"})}),"\n",(0,t.jsx)(n.h3,{id:"53-jmeter-\u914d\u7f6e",children:"5.3 JMeter \u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'thread_group:\n  threads: 100\n  ramp_up: 60      # 60 \u79d2\u542f\u52a8\u6240\u6709\u7ebf\u7a0b\n  duration: 1800   # \u6301\u7eed 30 \u5206\u949f\n\nhttp_request:\n  method: POST\n  path: /api/v1/orders\n  content_type: application/json\n  body: |\n    {\n      "userId": ${userId},\n      "goodsList": [{"goodsId": 2001, "quantity": 1}],\n      "amount": 100\n    }\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e03cicd-\u96c6\u6210\u89c4\u8303-must",children:"\u4e03\u3001CI/CD \u96c6\u6210\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"71-\u6d41\u6c34\u7ebf\u914d\u7f6e",children:"7.1 \u6d41\u6c34\u7ebf\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: Test Pipeline\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main, develop]\n\njobs:\n  unit-test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - name: Set up JDK 17\n        uses: actions/setup-java@v4\n        with:\n          java-version: '17'\n          distribution: 'temurin'\n          cache: maven\n\n      - name: Run Unit Tests\n        run: mvn test -Dtest=*ServiceTest\n\n      - name: Generate Coverage Report\n        run: mvn jacoco:report\n\n      - name: Check Coverage Threshold\n        run: |\n          COVERAGE=$(grep -oP 'Total.*?([0-9]+)%' target/site/jacoco/index.html | grep -oP '[0-9]+' | head -1)\n          if [ \"$COVERAGE\" -lt 80 ]; then\n            echo \"Coverage $COVERAGE% is below 80% threshold\"\n            exit 1\n          fi\n\n      - name: Upload Coverage Report\n        uses: actions/upload-artifact@v4\n        with:\n          name: jacoco-report\n          path: target/site/jacoco/\n\n  integration-test:\n    runs-on: ubuntu-latest\n    needs: unit-test\n    services:\n      mysql:\n        image: mysql:8.0\n        env:\n          MYSQL_ROOT_PASSWORD: test123\n          MYSQL_DATABASE: test_db\n        ports:\n          - 3306:3306\n      redis:\n        image: redis:6.2\n        ports:\n          - 6379:6379\n\n    steps:\n      - uses: actions/checkout@v4\n      - name: Run Integration Tests\n        run: mvn test -Dtest=*IntegrationTest\n        env:\n          SPRING_DATASOURCE_URL: jdbc:mysql://localhost:3306/test_db\n          SPRING_REDIS_HOST: localhost\n\n  api-test:\n    runs-on: ubuntu-latest\n    needs: integration-test\n    steps:\n      - name: Run API Tests\n        run: mvn test -Dtest=*ControllerTest\n"})}),"\n",(0,t.jsx)(n.h3,{id:"62-\u8d28\u91cf\u95e8\u7981",children:"6.2 \u8d28\u91cf\u95e8\u7981"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"quality_gates:\n  - unit_test_coverage >= 80%\n  - all_tests_passed\n  - no_critical_issues (SonarQube)\n  - no_high_vulnerabilities\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u516b\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",children:"\u516b\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5e8f\u53f7"}),(0,t.jsx)(n.th,{children:"\u53cd\u6a21\u5f0f"}),(0,t.jsx)(n.th,{children:"\u68c0\u6d4b\u65b9\u5f0f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"\u5355\u5143\u6d4b\u8bd5\u4f9d\u8d56\u771f\u5b9e DB"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u662f\u5426\u4f7f\u7528 @MockBean"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"\u53ea\u8986\u76d6\u6b63\u5e38\u573a\u666f"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u5f02\u5e38\u573a\u666f\u6d4b\u8bd5\u7528\u4f8b"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"\u63a5\u53e3\u6d4b\u8bd5\u4ec5\u9a8c\u8bc1 code=200"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u54cd\u5e94\u4f53\u65ad\u8a00"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsx)(n.td,{children:"\u6027\u80fd\u6d4b\u8bd5\u5728\u5f00\u53d1\u73af\u5883\u6267\u884c"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6d4b\u8bd5\u73af\u5883\u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5"}),(0,t.jsx)(n.td,{children:"\u5951\u7ea6\u6d4b\u8bd5\u7f3a\u5931"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u670d\u52a1\u95f4\u63a5\u53e3\u5b9a\u4e49"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6"}),(0,t.jsx)(n.td,{children:"\u6d4b\u8bd5\u6570\u636e\u672a\u9694\u79bb"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 @BeforeEach/@AfterEach"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"7"}),(0,t.jsx)(n.td,{children:"\u8986\u76d6\u7387\u4f4e\u4e8e 80%"}),(0,t.jsx)(n.td,{children:"JaCoCo \u62a5\u544a\u68c0\u67e5"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"\u672a\u96c6\u6210 CI/CD"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6d41\u6c34\u7ebf\u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"9"}),(0,t.jsx)(n.td,{children:"\u6d4b\u8bd5\u7528\u4f8b\u672a\u968f\u4ee3\u7801\u66f4\u65b0"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6d4b\u8bd5\u4ee3\u7801\u63d0\u4ea4\u8bb0\u5f55"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"10"}),(0,t.jsx)(n.td,{children:"\u541e\u5f02\u5e38\u4e0d\u65ad\u8a00"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 catch \u5757\u5904\u7406"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"11"}),(0,t.jsx)(n.td,{children:"\u4f7f\u7528\u56fa\u5b9a ID \u6d4b\u8bd5\u6570\u636e"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6d4b\u8bd5\u6570\u636e\u751f\u6210\u65b9\u5f0f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"12"}),(0,t.jsx)(n.td,{children:"\u4f9d\u8d56\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 @Order \u6ce8\u89e3\u4f7f\u7528"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var s=r(6540);const t={},d=s.createContext(t);function i(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);