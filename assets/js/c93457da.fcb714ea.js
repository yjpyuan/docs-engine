"use strict";(globalThis.webpackChunkw3bank_knowledge_wiki=globalThis.webpackChunkw3bank_knowledge_wiki||[]).push([[8403],{4987(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>x,frontMatter:()=>i,metadata:()=>d,toc:()=>a});const d=JSON.parse('{"id":"L0-enterprise/standards/coding-standards/java","title":"Java \u7f16\u7801\u89c4\u8303","description":"\u4f01\u4e1a\u7ea7\u7f16\u7801\u57fa\u7ebf\uff0cL1 \u9879\u76ee\u7ea7\u53ef\u7ec6\u5316","source":"@site/docs/L0-enterprise/standards/coding-standards/java.md","sourceDirName":"L0-enterprise/standards/coding-standards","slug":"/L0-enterprise/standards/coding-standards/java","permalink":"/docs/L0-enterprise/standards/coding-standards/java","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/L0-enterprise/standards/coding-standards/java.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"API \u8bbe\u8ba1\u89c4\u8303","permalink":"/docs/L0-enterprise/standards/api-design-guide"},"next":{"title":"python","permalink":"/docs/L0-enterprise/standards/coding-standards/python"}}');var s=r(4848),t=r(8453);const i={},l="Java \u7f16\u7801\u89c4\u8303",c={},a=[{value:"\u89c4\u8303\u4f18\u5148\u7ea7",id:"\u89c4\u8303\u4f18\u5148\u7ea7",level:2},{value:"\u4e00\u3001\u547d\u540d\u89c4\u8303 [MUST]",id:"\u4e00\u547d\u540d\u89c4\u8303-must",level:2},{value:"1.1 \u7c7b/\u63a5\u53e3/\u679a\u4e3e\u547d\u540d",id:"11-\u7c7b\u63a5\u53e3\u679a\u4e3e\u547d\u540d",level:3},{value:"1.2 \u65b9\u6cd5\u547d\u540d",id:"12-\u65b9\u6cd5\u547d\u540d",level:3},{value:"1.3 \u53d8\u91cf\u547d\u540d",id:"13-\u53d8\u91cf\u547d\u540d",level:3},{value:"1.4 \u5e38\u91cf\u547d\u540d",id:"14-\u5e38\u91cf\u547d\u540d",level:3},{value:"1.5 \u5305\u547d\u540d",id:"15-\u5305\u547d\u540d",level:3},{value:"\u4e8c\u3001\u6ce8\u91ca\u89c4\u8303 [MUST]",id:"\u4e8c\u6ce8\u91ca\u89c4\u8303-must",level:2},{value:"2.1 \u7c7b/\u63a5\u53e3\u6ce8\u91ca",id:"21-\u7c7b\u63a5\u53e3\u6ce8\u91ca",level:3},{value:"2.2 \u65b9\u6cd5\u6ce8\u91ca",id:"22-\u65b9\u6cd5\u6ce8\u91ca",level:3},{value:"2.3 \u4ee3\u7801\u5757\u6ce8\u91ca",id:"23-\u4ee3\u7801\u5757\u6ce8\u91ca",level:3},{value:"2.4 \u6ce8\u91ca\u7981\u6b62\u9879",id:"24-\u6ce8\u91ca\u7981\u6b62\u9879",level:3},{value:"\u4e09\u3001\u8bed\u6cd5\u907f\u5751\u89c4\u8303 [MUST]",id:"\u4e09\u8bed\u6cd5\u907f\u5751\u89c4\u8303-must",level:2},{value:"3.1 \u96c6\u5408\u4f7f\u7528",id:"31-\u96c6\u5408\u4f7f\u7528",level:3},{value:"3.2 \u5f02\u5e38\u5904\u7406",id:"32-\u5f02\u5e38\u5904\u7406",level:3},{value:"3.3 \u7a7a\u503c\u5904\u7406",id:"33-\u7a7a\u503c\u5904\u7406",level:3},{value:"3.4 \u5b57\u7b26\u4e32\u62fc\u63a5",id:"34-\u5b57\u7b26\u4e32\u62fc\u63a5",level:3},{value:"3.5 equals \u6bd4\u8f83",id:"35-equals-\u6bd4\u8f83",level:3},{value:"\u56db\u3001\u53c2\u6570\u6821\u9a8c\u89c4\u8303 [MUST]",id:"\u56db\u53c2\u6570\u6821\u9a8c\u89c4\u8303-must",level:2},{value:"4.1 JSR303 \u6ce8\u89e3",id:"41-jsr303-\u6ce8\u89e3",level:3},{value:"4.2 Controller \u5c42\u542f\u7528\u6821\u9a8c",id:"42-controller-\u5c42\u542f\u7528\u6821\u9a8c",level:3},{value:"\u4e94\u3001\u7ebf\u7a0b\u6c60\u89c4\u8303 [MUST]",id:"\u4e94\u7ebf\u7a0b\u6c60\u89c4\u8303-must",level:2},{value:"5.1 \u7981\u6b62\u4f7f\u7528 Executors",id:"51-\u7981\u6b62\u4f7f\u7528-executors",level:3},{value:"5.2 \u7ebf\u7a0b\u6c60\u914d\u7f6e",id:"52-\u7ebf\u7a0b\u6c60\u914d\u7f6e",level:3},{value:"\u516d\u3001\u9501\u673a\u5236\u89c4\u8303 [MUST]",id:"\u516d\u9501\u673a\u5236\u89c4\u8303-must",level:2},{value:"6.1 \u9501\u9009\u578b",id:"61-\u9501\u9009\u578b",level:3},{value:"6.2 ReentrantLock \u4f7f\u7528",id:"62-reentrantlock-\u4f7f\u7528",level:3},{value:"\u4e03\u3001ThreadLocal \u89c4\u8303 [MUST]",id:"\u4e03threadlocal-\u89c4\u8303-must",level:2},{value:"\u516b\u3001\u65e5\u671f\u65f6\u95f4\u89c4\u8303 [MUST]",id:"\u516b\u65e5\u671f\u65f6\u95f4\u89c4\u8303-must",level:2},{value:"\u4e5d\u3001\u6570\u636e\u5e93\u4ea4\u4e92\u89c4\u8303 [MUST]",id:"\u4e5d\u6570\u636e\u5e93\u4ea4\u4e92\u89c4\u8303-must",level:2},{value:"9.1 \u8fde\u63a5\u6c60\u9009\u578b",id:"91-\u8fde\u63a5\u6c60\u9009\u578b",level:3},{value:"9.2 HikariCP \u914d\u7f6e",id:"92-hikaricp-\u914d\u7f6e",level:3},{value:"9.3 \u8d44\u6e90\u91ca\u653e",id:"93-\u8d44\u6e90\u91ca\u653e",level:3},{value:"9.4 MyBatis ResultMap",id:"94-mybatis-resultmap",level:3},{value:"9.5 \u6279\u91cf\u64cd\u4f5c",id:"95-\u6279\u91cf\u64cd\u4f5c",level:3},{value:"\u5341\u3001\u7f13\u5b58\u89c4\u8303 [MUST]",id:"\u5341\u7f13\u5b58\u89c4\u8303-must",level:2},{value:"10.1 \u9009\u578b\u77e9\u9635",id:"101-\u9009\u578b\u77e9\u9635",level:3},{value:"10.2 Redis Key \u547d\u540d",id:"102-redis-key-\u547d\u540d",level:3},{value:"10.3 \u8fc7\u671f\u65f6\u95f4",id:"103-\u8fc7\u671f\u65f6\u95f4",level:3},{value:"10.4 \u5206\u5e03\u5f0f\u9501",id:"104-\u5206\u5e03\u5f0f\u9501",level:3},{value:"\u5341\u4e00\u3001\u5206\u5e03\u5f0f ID \u4e0e\u6d41\u6c34\u53f7\u89c4\u8303 [MUST]",id:"\u5341\u4e00\u5206\u5e03\u5f0f-id-\u4e0e\u6d41\u6c34\u53f7\u89c4\u8303-must",level:2},{value:"11.1 \u5206\u5e03\u5f0f ID \u9009\u578b",id:"111-\u5206\u5e03\u5f0f-id-\u9009\u578b",level:3},{value:"11.2 \u96ea\u82b1\u7b97\u6cd5 ID \u7ed3\u6784",id:"112-\u96ea\u82b1\u7b97\u6cd5-id-\u7ed3\u6784",level:3},{value:"11.3 \u4e1a\u52a1\u6d41\u6c34\u53f7\u89c4\u8303",id:"113-\u4e1a\u52a1\u6d41\u6c34\u53f7\u89c4\u8303",level:3},{value:"11.3.1 \u6d41\u6c34\u53f7\u683c\u5f0f",id:"1131-\u6d41\u6c34\u53f7\u683c\u5f0f",level:4},{value:"11.3.2 \u6d41\u6c34\u53f7\u751f\u6210\u5668",id:"1132-\u6d41\u6c34\u53f7\u751f\u6210\u5668",level:4},{value:"11.4 \u5e42\u7b49\u952e\u89c4\u8303",id:"114-\u5e42\u7b49\u952e\u89c4\u8303",level:3},{value:"11.5 ID \u957f\u5ea6\u6c47\u603b",id:"115-id-\u957f\u5ea6\u6c47\u603b",level:3},{value:"\u5341\u4e8c\u3001\u94fe\u5f0f\u8c03\u7528\u89c4\u8303 [MUST]",id:"\u5341\u4e8c\u94fe\u5f0f\u8c03\u7528\u89c4\u8303-must",level:2},{value:"12.1 \u9650\u5236\u89c4\u5219",id:"121-\u9650\u5236\u89c4\u5219",level:3},{value:"12.2 \u95ee\u9898\u793a\u4f8b",id:"122-\u95ee\u9898\u793a\u4f8b",level:3},{value:"12.3 \u63a8\u8350\u65b9\u6848",id:"123-\u63a8\u8350\u65b9\u6848",level:3},{value:"\u5341\u4e09\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",id:"\u5341\u4e09\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",level:2}];function h(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"java-\u7f16\u7801\u89c4\u8303",children:"Java \u7f16\u7801\u89c4\u8303"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u4f01\u4e1a\u7ea7\u7f16\u7801\u57fa\u7ebf\uff0cL1 \u9879\u76ee\u7ea7\u53ef\u7ec6\u5316"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u89c4\u8303\u4f18\u5148\u7ea7",children:"\u89c4\u8303\u4f18\u5148\u7ea7"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,s.jsx)(n.th,{children:"\u6807\u8bc6"}),(0,s.jsx)(n.th,{children:"\u542b\u4e49"}),(0,s.jsx)(n.th,{children:"AI \u884c\u4e3a"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udd34 \u5f3a\u5236"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"[MUST]"})}),(0,s.jsx)(n.td,{children:"\u8fdd\u53cd\u5c06\u5bfc\u81f4\u4e25\u91cd\u95ee\u9898"}),(0,s.jsx)(n.td,{children:"\u5fc5\u987b\u9075\u5b88\uff0c\u4e0d\u53ef\u59a5\u534f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udfe1 \u63a8\u8350"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"[SHOULD]"})}),(0,s.jsx)(n.td,{children:"\u6700\u4f73\u5b9e\u8df5"}),(0,s.jsx)(n.td,{children:"\u9ed8\u8ba4\u9075\u5b88\uff0c\u7279\u6b8a\u60c5\u51b5\u53ef\u8c03\u6574"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\ud83d\udfe2 \u5efa\u8bae"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"[MAY]"})}),(0,s.jsx)(n.td,{children:"\u53ef\u9009\u4f18\u5316"}),(0,s.jsx)(n.td,{children:"\u89c6\u60c5\u51b5\u91c7\u7528"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e00\u547d\u540d\u89c4\u8303-must",children:"\u4e00\u3001\u547d\u540d\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"11-\u7c7b\u63a5\u53e3\u679a\u4e3e\u547d\u540d",children:"1.1 \u7c7b/\u63a5\u53e3/\u679a\u4e3e\u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'rules:\n  format: UpperCamelCase\uff08\u5927\u9a7c\u5cf0\uff09\n  requirements:\n    - \u540d\u8bcd\u6216\u540d\u8bcd\u77ed\u8bed\n    - \u4f53\u73b0"\u4e1a\u52a1\u57df+\u89d2\u8272"\n    - \u7981\u6b62\u62fc\u97f3/\u62fc\u97f3\u82f1\u6587\u6df7\u5408\n    - \u7981\u6b62\u65e0\u610f\u4e49\u7f29\u5199\n'})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u683c\u5f0f"}),(0,s.jsx)(n.th,{children:"\u6b63\u786e\u793a\u4f8b"}),(0,s.jsx)(n.th,{children:"\u9519\u8bef\u793a\u4f8b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u666e\u901a\u7c7b"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxYyy"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderService"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"orderservice"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u63a5\u53e3"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxYyy"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"PaymentGateway"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"IPayment"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5b9e\u73b0\u7c7b"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxYyyImpl"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderServiceImpl"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderServiceImp"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u62bd\u8c61\u7c7b"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AbstractXxx"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AbstractValidator"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BaseValidator"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u679a\u4e3e"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxEnum"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderStatusEnum"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderStatus"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5f02\u5e38"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxException"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderNotFoundException"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderError"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DTO"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxDTO"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UserDTO"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UserDto"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"VO"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"XxxVO"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderVO"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderVo"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DO/Entity"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"XxxDO"}),"/",(0,s.jsx)(n.code,{children:"Xxx"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"OrderDO"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"TOrder"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"12-\u65b9\u6cd5\u547d\u540d",children:"1.2 \u65b9\u6cd5\u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"rules:\n  format: lowerCamelCase\uff08\u5c0f\u9a7c\u5cf0\uff09\n  structure: \u52a8\u8bcd + \u540d\u8bcd\n  requirements:\n    - \u52a8\u8bcd\u5f00\u5934\n    - \u660e\u786e\u8bed\u4e49\n    - \u7981\u6b62\u6570\u5b57\u540e\u7f00\uff08get1, get2\uff09\n"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u52a8\u8bcd\u524d\u7f00"}),(0,s.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"get"})}),(0,s.jsx)(n.td,{children:"\u7b80\u5355\u67e5\u8be2\uff08\u5355\u6761\uff09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"getUserById(Long userId)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"query"})}),(0,s.jsx)(n.td,{children:"\u590d\u6742\u67e5\u8be2\uff08\u591a\u6761\u4ef6/\u5206\u9875\uff09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"queryOrdersByCondition(OrderQuery query)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"find"})}),(0,s.jsx)(n.td,{children:"\u67e5\u627e\uff08\u53ef\u80fd\u8fd4\u56de null/\u96c6\u5408\uff09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"findActiveUsers()"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"list"})}),(0,s.jsx)(n.td,{children:"\u8fd4\u56de\u96c6\u5408"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"listOrdersByUserId(Long userId)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"create"})}),(0,s.jsx)(n.td,{children:"\u65b0\u5efa\uff08\u65e0 ID\uff09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"createOrder(OrderDTO dto)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"save"})}),(0,s.jsx)(n.td,{children:"\u4fdd\u5b58\uff08\u6709 ID \u66f4\u65b0\uff0c\u65e0 ID \u65b0\u589e\uff09"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"saveUser(UserDTO dto)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"update"})}),(0,s.jsx)(n.td,{children:"\u66f4\u65b0\u6307\u5b9a\u5b57\u6bb5"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"updateOrderStatus(Long id, Integer status)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"delete"}),"/",(0,s.jsx)(n.code,{children:"remove"})]}),(0,s.jsx)(n.td,{children:"\u5220\u9664"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"deleteById(Long id)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"validate"})}),(0,s.jsx)(n.td,{children:"\u6821\u9a8c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"validateParams(Request req)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"calculate"})}),(0,s.jsx)(n.td,{children:"\u8ba1\u7b97"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"calculateTotalAmount(List<Item> items)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"convert"}),"/",(0,s.jsx)(n.code,{children:"to"})]}),(0,s.jsx)(n.td,{children:"\u8f6c\u6362"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"convertToDTO(Entity entity)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"is"}),"/",(0,s.jsx)(n.code,{children:"has"}),"/",(0,s.jsx)(n.code,{children:"can"})]}),(0,s.jsx)(n.td,{children:"\u5e03\u5c14\u5224\u65ad"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"isValid()"}),", ",(0,s.jsx)(n.code,{children:"hasPermission()"})]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"13-\u53d8\u91cf\u547d\u540d",children:"1.3 \u53d8\u91cf\u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u274c \u9519\u8bef\nint a = 100;\nString str = "test";\nList list = new ArrayList();\nUser u = getUser();\n\n// \u2705 \u6b63\u786e\nint maxRetryCount = 100;\nString userName = "test";\nList<Order> orderList = new ArrayList<>();\nUser currentUser = getUser();\n'})}),"\n",(0,s.jsx)(n.h3,{id:"14-\u5e38\u91cf\u547d\u540d",children:"1.4 \u5e38\u91cf\u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\npublic static final int MAX_RETRY_COUNT = 3;\npublic static final String DEFAULT_CHARSET = "UTF-8";\npublic static final long CACHE_EXPIRE_SECONDS = 3600L;\n\n// \u274c \u9519\u8bef\npublic static int maxRetry = 3;  // \u7f3a\u5c11 final\npublic static final int MAX = 3;  // \u8bed\u4e49\u4e0d\u5b8c\u6574\n'})}),"\n",(0,s.jsx)(n.h3,{id:"15-\u5305\u547d\u540d",children:"1.5 \u5305\u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u2705 \u6b63\u786e\u7ed3\u6784\uff1a\ncom.company.mall.order.service\ncom.company.mall.order.controller\ncom.company.mall.order.mapper\ncom.company.mall.order.dto\n\n\u274c \u9519\u8bef\u7ed3\u6784\uff1a\ncom.company.Mall.order  // \u5927\u5199\ncom.company.mall_order  // \u4e0b\u5212\u7ebf\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e8c\u6ce8\u91ca\u89c4\u8303-must",children:"\u4e8c\u3001\u6ce8\u91ca\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"21-\u7c7b\u63a5\u53e3\u6ce8\u91ca",children:"2.1 \u7c7b/\u63a5\u53e3\u6ce8\u91ca"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"/**\n * \u8ba2\u5355\u670d\u52a1\u5b9e\u73b0\u7c7b\n * <p>\n * \u5904\u7406\u8ba2\u5355\u521b\u5efa\u3001\u67e5\u8be2\u3001\u72b6\u6001\u53d8\u66f4\u7b49\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\n * \u4f9d\u8d56\uff1aUserService\u3001ProductService\u3001PaymentService\n * </p>\n *\n * @author zhangsan\n * @since 2024-01-01\n * @see OrderMapper\n */\n@Service\npublic class OrderServiceImpl implements OrderService {\n    // ...\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"22-\u65b9\u6cd5\u6ce8\u91ca",children:"2.2 \u65b9\u6cd5\u6ce8\u91ca"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"/**\n * \u521b\u5efa\u8ba2\u5355\n * <p>\n * \u4e1a\u52a1\u6d41\u7a0b\uff1a\u53c2\u6570\u6821\u9a8c \u2192 \u5e93\u5b58\u68c0\u67e5 \u2192 \u521b\u5efa\u8ba2\u5355 \u2192 \u6263\u51cf\u5e93\u5b58 \u2192 \u53d1\u9001\u6d88\u606f\n * </p>\n *\n * @param request \u8ba2\u5355\u521b\u5efa\u8bf7\u6c42\uff0c\u5305\u542b\u7528\u6237 ID\u3001\u5546\u54c1\u5217\u8868\u3001\u6536\u8d27\u5730\u5740\n * @return \u521b\u5efa\u6210\u529f\u7684\u8ba2\u5355 ID\n * @throws IllegalArgumentException \u53c2\u6570\u6821\u9a8c\u5931\u8d25\n * @throws InsufficientStockException \u5e93\u5b58\u4e0d\u8db3\n * @throws OrderCreateException \u8ba2\u5355\u521b\u5efa\u5931\u8d25\n */\npublic Long createOrder(OrderCreateRequest request) {\n    // ...\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"23-\u4ee3\u7801\u5757\u6ce8\u91ca",children:"2.3 \u4ee3\u7801\u5757\u6ce8\u91ca"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1a\u8bf4\u660e\u4e1a\u52a1\u539f\u56e0\n// \u8ba2\u5355\u8d85\u8fc7 30 \u5929\u672a\u652f\u4ed8\uff0c\u81ea\u52a8\u5173\u95ed\uff08\u4e1a\u52a1\u89c4\u5219\uff1a\u9632\u6b62\u5e93\u5b58\u957f\u671f\u5360\u7528\uff09\nif (order.getCreateTime().plusDays(30).isBefore(LocalDateTime.now())) {\n    closeOrder(order);\n}\n\n// \u274c \u9519\u8bef\uff1a\u91cd\u590d\u4ee3\u7801\u903b\u8f91\n// \u5982\u679c\u521b\u5efa\u65f6\u95f4\u52a0 30 \u5929\u5728\u5f53\u524d\u65f6\u95f4\u4e4b\u524d\nif (order.getCreateTime().plusDays(30).isBefore(LocalDateTime.now())) {\n    closeOrder(order);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"24-\u6ce8\u91ca\u7981\u6b62\u9879",children:"2.4 \u6ce8\u91ca\u7981\u6b62\u9879"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"prohibited:\n  - \u6ce8\u91ca\u6389\u7684\u4ee3\u7801\u5757\uff08\u5220\u9664\u800c\u975e\u6ce8\u91ca\uff09\n  - \u8fc7\u65f6\u7684\u6ce8\u91ca\uff08\u4ee3\u7801\u6539\u4e86\u6ce8\u91ca\u6ca1\u6539\uff09\n  - \u65e0\u610f\u4e49\u7684\u6ce8\u91ca\uff08\u5982\uff1a// \u83b7\u53d6\u7528\u6237\uff09\n  - TODO \u540e\u65e0\u8d23\u4efb\u4eba\u548c\u65f6\u95f4\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u274c \u7981\u6b62\n// User user = userService.getById(id);  // \u6ce8\u91ca\u6389\u7684\u4ee3\u7801\n// TODO: \u5f85\u4f18\u5316  // \u65e0\u8d23\u4efb\u4eba\n\n// \u2705 \u6b63\u786e\n// TODO(zhangsan): 2024-02-01 \u4f18\u5316 N+1 \u67e5\u8be2\u95ee\u9898\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e09\u8bed\u6cd5\u907f\u5751\u89c4\u8303-must",children:"\u4e09\u3001\u8bed\u6cd5\u907f\u5751\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"31-\u96c6\u5408\u4f7f\u7528",children:"3.1 \u96c6\u5408\u4f7f\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1a\u6307\u5b9a\u5bb9\u91cf\u548c\u6cdb\u578b\nList<User> userList = new ArrayList<>(100);\nMap<Long, Order> orderMap = new HashMap<>(16);\nSet<String> tagSet = new HashSet<>(8);\n\n// \u2705 \u6b63\u786e\uff1a\u904d\u5386\u5220\u9664\nIterator<User> iterator = userList.iterator();\nwhile (iterator.hasNext()) {\n    if (iterator.next().isInvalid()) {\n        iterator.remove();\n    }\n}\n\n// \u2705 \u6b63\u786e\uff1a\u591a\u7ebf\u7a0b\u573a\u666f\nMap<Long, User> concurrentMap = new ConcurrentHashMap<>();\nList<String> threadSafeList = new CopyOnWriteArrayList<>();\n\n// \u274c \u9519\u8bef\nList list = new ArrayList();  // \u65e0\u6cdb\u578b\nMap map = new HashMap();  // \u65e0\u5bb9\u91cf\u65e0\u6cdb\u578b\nfor (User user : userList) {  // \u904d\u5386\u4e2d\u5220\u9664\n    if (user.isInvalid()) userList.remove(user);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"32-\u5f02\u5e38\u5904\u7406",children:"3.2 \u5f02\u5e38\u5904\u7406"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\ntry {\n    orderService.createOrder(request);\n} catch (InsufficientStockException e) {\n    log.warn("\u5e93\u5b58\u4e0d\u8db3, productId={}, required={}",\n             e.getProductId(), e.getRequiredQuantity());\n    throw new BusinessException("\u5e93\u5b58\u4e0d\u8db3\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");\n} catch (Exception e) {\n    log.error("\u521b\u5efa\u8ba2\u5355\u5931\u8d25, userId={}, request={}",\n              userId, JSON.toJSONString(request), e);\n    throw new SystemException("\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");\n}\n\n// \u274c \u9519\u8bef\uff1a\u541e\u5f02\u5e38\ntry {\n    orderService.createOrder(request);\n} catch (Exception e) {\n    // \u541e\u5f02\u5e38\n}\n\n// \u274c \u9519\u8bef\uff1a\u4f7f\u7528 e.printStackTrace()\ntry {\n    orderService.createOrder(request);\n} catch (Exception e) {\n    e.printStackTrace();  // \u7981\u6b62\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"33-\u7a7a\u503c\u5904\u7406",children:"3.3 \u7a7a\u503c\u5904\u7406"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\uff1aOptional\npublic String getUserName(Long userId) {\n    return Optional.ofNullable(userMapper.selectById(userId))\n            .map(User::getName)\n            .orElse("\u672a\u77e5\u7528\u6237");\n}\n\n// \u2705 \u6b63\u786e\uff1a\u8fd4\u56de\u7a7a\u96c6\u5408\npublic List<Order> getOrders(Long userId) {\n    List<Order> orders = orderMapper.selectByUserId(userId);\n    return orders != null ? orders : Collections.emptyList();\n}\n\n// \u2705 \u6b63\u786e\uff1a\u5b57\u7b26\u4e32\u5224\u7a7a\nif (StringUtils.isNotBlank(userName)) {\n    // ...\n}\n\n// \u274c \u9519\u8bef\uff1a\u591a\u5c42\u5224\u7a7a\nif (user != null && user.getAddress() != null\n    && user.getAddress().getCity() != null) {\n    // ...\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"34-\u5b57\u7b26\u4e32\u62fc\u63a5",children:"3.4 \u5b57\u7b26\u4e32\u62fc\u63a5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\nStringBuilder sb = new StringBuilder();\nfor (String item : items) {\n    sb.append(item).append(",");\n}\n\nString message = String.format("\u7528\u6237%s\u521b\u5efa\u8ba2\u5355%d\u6210\u529f", userName, orderId);\n\n// \u274c \u9519\u8bef\nString result = "";\nfor (String item : items) {\n    result += item + ",";  // \u6027\u80fd\u5dee\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"35-equals-\u6bd4\u8f83",children:"3.5 equals \u6bd4\u8f83"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\nif ("ACTIVE".equals(status)) { }\nif (Objects.equals(status, targetStatus)) { }\n\n// \u274c \u9519\u8bef\uff08\u53ef\u80fd NPE\uff09\nif (status.equals("ACTIVE")) { }\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u56db\u53c2\u6570\u6821\u9a8c\u89c4\u8303-must",children:"\u56db\u3001\u53c2\u6570\u6821\u9a8c\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"41-jsr303-\u6ce8\u89e3",children:"4.1 JSR303 \u6ce8\u89e3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Data\npublic class OrderCreateRequest {\n\n    @NotNull(message = "\u7528\u6237 ID \u4e0d\u80fd\u4e3a\u7a7a")\n    private Long userId;\n\n    @NotEmpty(message = "\u5546\u54c1\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a")\n    @Size(min = 1, max = 100, message = "\u5546\u54c1\u6570\u91cf 1-100 \u4ef6")\n    private List<OrderItemDTO> items;\n\n    @NotNull(message = "\u8ba2\u5355\u91d1\u989d\u4e0d\u80fd\u4e3a\u7a7a")\n    @DecimalMin(value = "0.01", message = "\u8ba2\u5355\u91d1\u989d\u5fc5\u987b\u5927\u4e8e 0")\n    private BigDecimal amount;\n\n    @Pattern(regexp = "^1[3-9]\\\\d{9}$", message = "\u624b\u673a\u53f7\u683c\u5f0f\u4e0d\u6b63\u786e")\n    private String phone;\n\n    @Email(message = "\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e")\n    private String email;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"42-controller-\u5c42\u542f\u7528\u6821\u9a8c",children:"4.2 Controller \u5c42\u542f\u7528\u6821\u9a8c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@PostMapping("/orders")\npublic Result<Long> createOrder(@Valid @RequestBody OrderCreateRequest request) {\n    return Result.success(orderService.createOrder(request));\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e94\u7ebf\u7a0b\u6c60\u89c4\u8303-must",children:"\u4e94\u3001\u7ebf\u7a0b\u6c60\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"51-\u7981\u6b62\u4f7f\u7528-executors",children:"5.1 \u7981\u6b62\u4f7f\u7528 Executors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"prohibited:\n  - Executors.newFixedThreadPool()    # \u65e0\u754c\u961f\u5217\uff0cOOM \u98ce\u9669\n  - Executors.newCachedThreadPool()   # \u65e0\u9650\u7ebf\u7a0b\uff0c\u8d44\u6e90\u8017\u5c3d\n  - Executors.newSingleThreadExecutor()\n  - Executors.newScheduledThreadPool()\nrequired: \u624b\u52a8\u521b\u5efa ThreadPoolExecutor\n"})}),"\n",(0,s.jsx)(n.h3,{id:"52-\u7ebf\u7a0b\u6c60\u914d\u7f6e",children:"5.2 \u7ebf\u7a0b\u6c60\u914d\u7f6e"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u53c2\u6570"}),(0,s.jsx)(n.th,{children:"IO \u5bc6\u96c6\u578b"}),(0,s.jsx)(n.th,{children:"CPU \u5bc6\u96c6\u578b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6838\u5fc3\u7ebf\u7a0b\u6570"}),(0,s.jsx)(n.td,{children:"CPU \u6838\u6570\xd72"}),(0,s.jsx)(n.td,{children:"CPU \u6838\u6570+1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u6700\u5927\u7ebf\u7a0b\u6570"}),(0,s.jsx)(n.td,{children:"CPU \u6838\u6570\xd74"}),(0,s.jsx)(n.td,{children:"CPU \u6838\u6570+1"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u961f\u5217\u5bb9\u91cf"}),(0,s.jsx)(n.td,{children:"\u6709\u754c\u961f\u5217 1000"}),(0,s.jsx)(n.td,{children:"\u6709\u754c\u961f\u5217 500"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7a7a\u95f2\u65f6\u95f4"}),(0,s.jsx)(n.td,{children:"60 \u79d2"}),(0,s.jsx)(n.td,{children:"10 \u79d2"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u62d2\u7edd\u7b56\u7565"}),(0,s.jsx)(n.td,{children:"CallerRunsPolicy"}),(0,s.jsx)(n.td,{children:"AbortPolicy"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class ThreadPoolConfig {\n    private static final int CPU_CORES = Runtime.getRuntime().availableProcessors();\n\n    @Bean(name = "ioIntensiveThreadPool")\n    public ExecutorService ioIntensiveThreadPool() {\n        ThreadFactory threadFactory = new ThreadFactoryBuilder()\n                .setNameFormat("io-thread-%d")\n                .setDaemon(true)\n                .build();\n        return new ThreadPoolExecutor(\n            CPU_CORES * 2,\n            CPU_CORES * 4,\n            60, TimeUnit.SECONDS,\n            new ArrayBlockingQueue<>(1000),\n            threadFactory,\n            new ThreadPoolExecutor.CallerRunsPolicy()\n        );\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u516d\u9501\u673a\u5236\u89c4\u8303-must",children:"\u516d\u3001\u9501\u673a\u5236\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"61-\u9501\u9009\u578b",children:"6.1 \u9501\u9009\u578b"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u9501\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u4f18\u70b9"}),(0,s.jsx)(n.th,{children:"\u7f3a\u70b9"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"synchronized"}),(0,s.jsx)(n.td,{children:"\u7b80\u5355\u540c\u6b65"}),(0,s.jsx)(n.td,{children:"\u7528\u6cd5\u7b80\u5355\u3001JVM \u4f18\u5316\u597d"}),(0,s.jsx)(n.td,{children:"\u9501\u7c92\u5ea6\u7c97\u3001\u65e0\u6cd5\u4e2d\u65ad"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ReentrantLock"}),(0,s.jsx)(n.td,{children:"\u590d\u6742\u540c\u6b65"}),(0,s.jsx)(n.td,{children:"\u652f\u6301\u8d85\u65f6\u3001\u4e2d\u65ad\u3001\u516c\u5e73\u9501"}),(0,s.jsx)(n.td,{children:"\u9700\u624b\u52a8\u91ca\u653e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ReadWriteLock"}),(0,s.jsx)(n.td,{children:"\u8bfb\u591a\u5199\u5c11"}),(0,s.jsx)(n.td,{children:"\u8bfb\u64cd\u4f5c\u5171\u4eab"}),(0,s.jsx)(n.td,{children:"\u5b9e\u73b0\u590d\u6742"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"62-reentrantlock-\u4f7f\u7528",children:"6.2 ReentrantLock \u4f7f\u7528"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'private final ReentrantLock lock = new ReentrantLock();\n\npublic Long createOrder(OrderCreateRequest request) {\n    boolean locked = false;\n    try {\n        locked = lock.tryLock(3, TimeUnit.SECONDS);\n        if (locked) {\n            return doCreate(request);\n        } else {\n            throw new ServiceException("\u521b\u5efa\u8ba2\u5355\u8fc7\u4e8e\u9891\u7e41");\n        }\n    } catch (InterruptedException e) {\n        Thread.currentThread().interrupt();\n        throw new ServiceException("\u64cd\u4f5c\u88ab\u4e2d\u65ad");\n    } finally {\n        if (locked) {\n            lock.unlock();  // \u5fc5\u987b\u624b\u52a8\u91ca\u653e\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e03threadlocal-\u89c4\u8303-must",children:"\u4e03\u3001ThreadLocal \u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1a\u4f7f\u7528\u540e\u6e05\u7406\nprivate static final ThreadLocal<User> USER_HOLDER = new ThreadLocal<>();\n\n@Override\npublic boolean preHandle(HttpServletRequest request, ...) {\n    USER_HOLDER.set(getCurrentUser());\n    return true;\n}\n\n@Override\npublic void afterCompletion(HttpServletRequest request, ...) {\n    USER_HOLDER.remove();  // \u5fc5\u987b\u6e05\u7406\n}\n\n// \u274c \u9519\u8bef\uff1a\u672a\u6e05\u7406 ThreadLocal\npublic void process() {\n    USER_HOLDER.set(user);\n    // \u672a\u8c03\u7528 remove()\uff0c\u7ebf\u7a0b\u590d\u7528\u65f6\u6570\u636e\u6df7\u4e71\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u516b\u65e5\u671f\u65f6\u95f4\u89c4\u8303-must",children:"\u516b\u3001\u65e5\u671f\u65f6\u95f4\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u274c \u9519\u8bef\uff1aSimpleDateFormat \u975e\u7ebf\u7a0b\u5b89\u5168\nprivate static final SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");\n\n// \u2705 \u6b63\u786e\uff1a\u4f7f\u7528 DateTimeFormatter\nprivate static final DateTimeFormatter formatter =\n    DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");\n\npublic String formatDate(LocalDateTime dateTime) {\n    return formatter.format(dateTime);\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u4e5d\u6570\u636e\u5e93\u4ea4\u4e92\u89c4\u8303-must",children:"\u4e5d\u3001\u6570\u636e\u5e93\u4ea4\u4e92\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"91-\u8fde\u63a5\u6c60\u9009\u578b",children:"9.1 \u8fde\u63a5\u6c60\u9009\u578b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"required: HikariCP\nprohibited:\n  - C3P0\uff08\u6027\u80fd\u5dee\uff0c\u5df2\u8fc7\u65f6\uff09\n  - DBCP\uff08\u6027\u80fd\u5dee\uff09\n"})}),"\n",(0,s.jsx)(n.h3,{id:"92-hikaricp-\u914d\u7f6e",children:"9.2 HikariCP \u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  datasource:\n    hikari:\n      maximum-pool-size: 20\n      minimum-idle: 10\n      connection-timeout: 30000\n      idle-timeout: 600000\n      max-lifetime: 1800000\n      leak-detection-threshold: 5000\n      connection-test-query: SELECT 1\n"})}),"\n",(0,s.jsx)(n.h3,{id:"93-\u8d44\u6e90\u91ca\u653e",children:"9.3 \u8d44\u6e90\u91ca\u653e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1atry-with-resources\ntry (Connection conn = dataSource.getConnection();\n     PreparedStatement ps = conn.prepareStatement(sql);\n     ResultSet rs = ps.executeQuery()) {\n    while (rs.next()) {\n        // \u5904\u7406\u7ed3\u679c\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"94-mybatis-resultmap",children:"9.4 MyBatis ResultMap"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'\x3c!-- \u2705 \u6b63\u786e\uff1aResultMap --\x3e\n<resultMap id="OrderResultMap" type="com.example.entity.Order">\n    <id column="id" property="id"/>\n    <result column="order_no" property="orderNo"/>\n    <result column="user_id" property="userId"/>\n</resultMap>\n\n\x3c!-- \u274c \u9519\u8bef\uff1aresultType="map" --\x3e\n<select id="selectById" resultType="map">\n    SELECT * FROM order_info WHERE id = #{id}\n</select>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"95-\u6279\u91cf\u64cd\u4f5c",children:"9.5 \u6279\u91cf\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1a\u5206\u6279\u5904\u7406\npublic void batchInsertOrders(List<Order> orders) {\n    int batchSize = 500;\n    for (int i = 0; i < orders.size(); i += batchSize) {\n        List<Order> batch = orders.subList(i, Math.min(i + batchSize, orders.size()));\n        orderMapper.batchInsert(batch);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u5341\u7f13\u5b58\u89c4\u8303-must",children:"\u5341\u3001\u7f13\u5b58\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"101-\u9009\u578b\u77e9\u9635",children:"10.1 \u9009\u578b\u77e9\u9635"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u7f13\u5b58\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u5de5\u5177\u9009\u578b"}),(0,s.jsx)(n.th,{children:"\u9002\u7528\u6761\u4ef6"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u4f4e\u5e76\u53d1\u9759\u6001\u6570\u636e"}),(0,s.jsx)(n.td,{children:"\u672c\u5730\u7f13\u5b58"}),(0,s.jsx)(n.td,{children:"Caffeine"}),(0,s.jsx)(n.td,{children:"QPS\u22641000"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9ad8\u5e76\u53d1\u5171\u4eab\u6570\u636e"}),(0,s.jsx)(n.td,{children:"\u5206\u5e03\u5f0f\u7f13\u5b58"}),(0,s.jsx)(n.td,{children:"Redis"}),(0,s.jsx)(n.td,{children:"QPS\u22651000"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8d85\u9ad8\u5e76\u53d1\u70ed\u70b9"}),(0,s.jsx)(n.td,{children:"\u591a\u7ea7\u7f13\u5b58"}),(0,s.jsx)(n.td,{children:"\u672c\u5730+Redis"}),(0,s.jsx)(n.td,{children:"QPS\u226510000"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"102-redis-key-\u547d\u540d",children:"10.2 Redis Key \u547d\u540d"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"format: \u4e1a\u52a1\u57df:\u6a21\u5757:\u8d44\u6e90:\u552f\u4e00\u6807\u8bc6\nseparator: \u5192\u53f7(:)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\u547d\u540d\nString userKey = "mall:user:info:" + userId;\nString orderKey = "mall:order:detail:" + orderId;\nString lockKey = "mall:lock:order:" + orderId;\n\n// \u274c \u9519\u8bef\u547d\u540d\nString key1 = "user_" + userId;           // \u5206\u9694\u7b26\u4e0d\u89c4\u8303\nString key2 = "USER:" + userId;           // \u5927\u5199\n'})}),"\n",(0,s.jsx)(n.h3,{id:"103-\u8fc7\u671f\u65f6\u95f4",children:"10.3 \u8fc7\u671f\u65f6\u95f4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\uff1a\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\nredisTemplate.opsForValue().set(key, value, 30, TimeUnit.MINUTES);\n\n// \u274c \u9519\u8bef\uff1a\u4e0d\u8bbe\u8fc7\u671f\u65f6\u95f4\nredisTemplate.opsForValue().set(key, value);  // \u6c38\u4e0d\u8fc7\u671f\n"})}),"\n",(0,s.jsx)(n.h3,{id:"104-\u5206\u5e03\u5f0f\u9501",children:"10.4 \u5206\u5e03\u5f0f\u9501"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\uff1a\u4f7f\u7528 Redisson\npublic void processOrder(Long orderId) {\n    String lockKey = "lock:order:" + orderId;\n    RLock lock = redissonClient.getLock(lockKey);\n\n    try {\n        if (lock.tryLock(3, 10, TimeUnit.SECONDS)) {\n            doProcess(orderId);\n        } else {\n            throw new BusinessException("\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");\n        }\n    } catch (InterruptedException e) {\n        Thread.currentThread().interrupt();\n        throw new BusinessException("\u64cd\u4f5c\u88ab\u4e2d\u65ad");\n    } finally {\n        if (lock.isHeldByCurrentThread()) {\n            lock.unlock();\n        }\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u5341\u4e00\u5206\u5e03\u5f0f-id-\u4e0e\u6d41\u6c34\u53f7\u89c4\u8303-must",children:"\u5341\u4e00\u3001\u5206\u5e03\u5f0f ID \u4e0e\u6d41\u6c34\u53f7\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"111-\u5206\u5e03\u5f0f-id-\u9009\u578b",children:"11.1 \u5206\u5e03\u5f0f ID \u9009\u578b"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u65b9\u6848"}),(0,s.jsx)(n.th,{children:"\u957f\u5ea6"}),(0,s.jsx)(n.th,{children:"\u9002\u7528\u573a\u666f"}),(0,s.jsx)(n.th,{children:"\u4f18\u70b9"}),(0,s.jsx)(n.th,{children:"\u7f3a\u70b9"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u96ea\u82b1\u7b97\u6cd5"}),(0,s.jsx)(n.td,{children:"19 \u4f4d\uff08Long\uff09"}),(0,s.jsx)(n.td,{children:"\u9ad8\u5e76\u53d1\u3001\u6709\u5e8f"}),(0,s.jsx)(n.td,{children:"\u8d8b\u52bf\u9012\u589e\u3001\u6027\u80fd\u9ad8"}),(0,s.jsx)(n.td,{children:"\u65f6\u949f\u56de\u62e8\u95ee\u9898"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Leaf-Segment"}),(0,s.jsx)(n.td,{children:"\u53ef\u914d\u7f6e"}),(0,s.jsx)(n.td,{children:"\u4e2d\u7b49\u5e76\u53d1"}),(0,s.jsx)(n.td,{children:"\u7b80\u5355\u53ef\u9760"}),(0,s.jsx)(n.td,{children:"\u4f9d\u8d56 DB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Leaf-Snowflake"}),(0,s.jsx)(n.td,{children:"19 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u9ad8\u5e76\u53d1"}),(0,s.jsx)(n.td,{children:"\u89e3\u51b3\u65f6\u949f\u56de\u62e8"}),(0,s.jsx)(n.td,{children:"\u4f9d\u8d56 ZK"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"32/36 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u4f4e\u5e76\u53d1\u3001\u65e0\u5e8f\u53ef"}),(0,s.jsx)(n.td,{children:"\u65e0\u4f9d\u8d56"}),(0,s.jsx)(n.td,{children:"\u65e0\u5e8f\u3001\u5b58\u50a8\u5927"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"112-\u96ea\u82b1\u7b97\u6cd5-id-\u7ed3\u6784",children:"11.2 \u96ea\u82b1\u7b97\u6cd5 ID \u7ed3\u6784"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1 bit  \u2502      41 bit         \u2502   10 bit    \u2502      12 bit          \u2502\n\u2502  \u7b26\u53f7\u4f4d  \u2502     \u65f6\u95f4\u6233(ms)       \u2502   \u673a\u5668 ID    \u2502      \u5e8f\u5217\u53f7           \u2502\n\u2502    0    \u2502  \u7ea6 69 \u5e74           \u2502  1024 \u8282\u70b9  \u2502   4096/ms            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u2705 \u6b63\u786e\uff1a\u4f7f\u7528 Hutool \u96ea\u82b1\u7b97\u6cd5\n@Configuration\npublic class SnowflakeConfig {\n    @Value("${snowflake.workerId:1}")\n    private long workerId;\n\n    @Value("${snowflake.datacenterId:1}")\n    private long datacenterId;\n\n    @Bean\n    public Snowflake snowflake() {\n        return IdUtil.getSnowflake(workerId, datacenterId);\n    }\n}\n\n@Service\npublic class IdGeneratorService {\n    @Autowired\n    private Snowflake snowflake;\n\n    public long nextId() {\n        return snowflake.nextId();\n    }\n\n    public String nextIdStr() {\n        return snowflake.nextIdStr();\n    }\n}\n\n// \u274c \u7981\u6b62\uff1a\u6bcf\u6b21 new Snowflake\npublic long getId() {\n    return IdUtil.getSnowflake(1, 1).nextId();  // \u7981\u6b62\uff01\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"113-\u4e1a\u52a1\u6d41\u6c34\u53f7\u89c4\u8303",children:"11.3 \u4e1a\u52a1\u6d41\u6c34\u53f7\u89c4\u8303"}),"\n",(0,s.jsx)(n.h4,{id:"1131-\u6d41\u6c34\u53f7\u683c\u5f0f",children:"11.3.1 \u6d41\u6c34\u53f7\u683c\u5f0f"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'format: "{\u4e1a\u52a1\u524d\u7f00}{\u65e5\u671f}{\u5e8f\u5217\u53f7}{\u968f\u673a\u7801}"\nlength: 24-32 \u4f4d\n'})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u4e1a\u52a1\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u524d\u7f00"}),(0,s.jsx)(n.th,{children:"\u683c\u5f0f"}),(0,s.jsx)(n.th,{children:"\u793a\u4f8b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8ba2\u5355\u53f7"}),(0,s.jsx)(n.td,{children:"ORD"}),(0,s.jsx)(n.td,{children:"ORD + yyyyMMdd + 10\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a"}),(0,s.jsx)(n.td,{children:"ORD202401150000000001A3F2"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u652f\u4ed8\u6d41\u6c34\u53f7"}),(0,s.jsx)(n.td,{children:"PAY"}),(0,s.jsx)(n.td,{children:"PAY + yyyyMMddHHmmss + 8\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a"}),(0,s.jsx)(n.td,{children:"PAY20240115143052000000019B7C"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u9000\u6b3e\u5355\u53f7"}),(0,s.jsx)(n.td,{children:"REF"}),(0,s.jsx)(n.td,{children:"REF + yyyyMMdd + 10\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a"}),(0,s.jsx)(n.td,{children:"REF202401150000000001D4E8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7269\u6d41\u5355\u53f7"}),(0,s.jsx)(n.td,{children:"LOG"}),(0,s.jsx)(n.td,{children:"LOG + yyyyMMdd + 10\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a"}),(0,s.jsx)(n.td,{children:"LOG202401150000000001F5A9"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u7528\u6237\u7f16\u53f7"}),(0,s.jsx)(n.td,{children:"USR"}),(0,s.jsx)(n.td,{children:"USR + 16\u4f4d\u96ea\u82b1ID"}),(0,s.jsx)(n.td,{children:"USR1234567890123456"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"1132-\u6d41\u6c34\u53f7\u751f\u6210\u5668",children:"11.3.2 \u6d41\u6c34\u53f7\u751f\u6210\u5668"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\npublic class BizNoGenerator {\n    @Autowired\n    private StringRedisTemplate redisTemplate;\n\n    private static final String ORDER_NO_KEY = "seq:order:%s";\n    private static final String PAY_NO_KEY = "seq:pay:%s";\n\n    /**\n     * \u751f\u6210\u8ba2\u5355\u53f7\uff1aORD + yyyyMMdd + 10\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a\n     * \u793a\u4f8b\uff1aORD202401150000000001A3F2\n     */\n    public String generateOrderNo() {\n        String date = LocalDate.now().format(DateTimeFormatter.BASIC_ISO_DATE);\n        String key = String.format(ORDER_NO_KEY, date);\n\n        Long seq = redisTemplate.opsForValue().increment(key);\n        if (seq == 1) {\n            redisTemplate.expire(key, 2, TimeUnit.DAYS);  // \u8fc7\u671f\u65f6\u95f4 2 \u5929\n        }\n\n        String seqStr = String.format("%010d", seq);  // 10 \u4f4d\u5e8f\u5217\u53f7\uff0c\u5de6\u8865\u96f6\n        String random = generateRandom(4);  // 4 \u4f4d\u968f\u673a\u7801\n\n        return "ORD" + date + seqStr + random;\n    }\n\n    /**\n     * \u751f\u6210\u652f\u4ed8\u6d41\u6c34\u53f7\uff1aPAY + yyyyMMddHHmmss + 8\u4f4d\u5e8f\u5217 + 4\u4f4d\u968f\u673a\n     * \u793a\u4f8b\uff1aPAY20240115143052000000019B7C\n     */\n    public String generatePayNo() {\n        String datetime = LocalDateTime.now()\n            .format(DateTimeFormatter.ofPattern("yyyyMMddHHmmss"));\n        String key = String.format(PAY_NO_KEY, datetime.substring(0, 8));\n\n        Long seq = redisTemplate.opsForValue().increment(key);\n        if (seq == 1) {\n            redisTemplate.expire(key, 2, TimeUnit.DAYS);\n        }\n\n        String seqStr = String.format("%08d", seq);\n        String random = generateRandom(4);\n\n        return "PAY" + datetime + seqStr + random;\n    }\n\n    /**\n     * \u751f\u6210\u968f\u673a\u7801\uff08\u5927\u5199\u5b57\u6bcd+\u6570\u5b57\uff09\n     */\n    private String generateRandom(int length) {\n        String chars = "0123456789ABCDEF";\n        StringBuilder sb = new StringBuilder();\n        ThreadLocalRandom random = ThreadLocalRandom.current();\n        for (int i = 0; i < length; i++) {\n            sb.append(chars.charAt(random.nextInt(chars.length())));\n        }\n        return sb.toString();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"114-\u5e42\u7b49\u952e\u89c4\u8303",children:"11.4 \u5e42\u7b49\u952e\u89c4\u8303"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'format: "{\u4e1a\u52a1\u7c7b\u578b}:{\u7528\u6237ID}:{\u4e1a\u52a1\u53c2\u6570\u54c8\u5e0c}"\nexpire: 30 \u5206\u949f\nstorage: Redis\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\npublic class IdempotentKeyGenerator {\n\n    /**\n     * \u751f\u6210\u5e42\u7b49\u952e\n     * \u683c\u5f0f\uff1aidempotent:{bizType}:{userId}:{paramHash}\n     */\n    public String generate(String bizType, Long userId, Object params) {\n        String paramHash = DigestUtils.md5Hex(JSON.toJSONString(params));\n        return String.format("idempotent:%s:%d:%s", bizType, userId, paramHash);\n    }\n\n    /**\n     * \u751f\u6210\u8ba2\u5355\u521b\u5efa\u5e42\u7b49\u952e\n     */\n    public String generateOrderKey(Long userId, OrderCreateRequest request) {\n        return generate("order:create", userId, request);\n    }\n}\n\n// \u4f7f\u7528\u793a\u4f8b\n@PostMapping("/orders")\npublic Result<Long> createOrder(@RequestHeader("X-Request-Id") String requestId,\n                                 @RequestBody OrderCreateRequest request) {\n    // \u4f18\u5148\u4f7f\u7528\u5ba2\u6237\u7aef\u4f20\u5165\u7684\u8bf7\u6c42 ID\n    String idempotentKey = StringUtils.isNotBlank(requestId)\n        ? "idempotent:order:" + requestId\n        : idempotentKeyGenerator.generateOrderKey(getCurrentUserId(), request);\n\n    Boolean isNew = redisTemplate.opsForValue()\n        .setIfAbsent(idempotentKey, "1", 30, TimeUnit.MINUTES);\n\n    if (Boolean.FALSE.equals(isNew)) {\n        throw new BusinessException("\u8bf7\u52ff\u91cd\u590d\u63d0\u4ea4");\n    }\n\n    return Result.success(orderService.createOrder(request));\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"115-id-\u957f\u5ea6\u6c47\u603b",children:"11.5 ID \u957f\u5ea6\u6c47\u603b"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"ID \u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u957f\u5ea6"}),(0,s.jsx)(n.th,{children:"\u683c\u5f0f"}),(0,s.jsx)(n.th,{children:"\u5b58\u50a8\u7c7b\u578b"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u96ea\u82b1 ID"}),(0,s.jsx)(n.td,{children:"19 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u7eaf\u6570\u5b57"}),(0,s.jsx)(n.td,{children:"BIGINT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TraceId"}),(0,s.jsx)(n.td,{children:"32 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5c0f\u5199\u5341\u516d\u8fdb\u5236"}),(0,s.jsx)(n.td,{children:"VARCHAR(32)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SpanId"}),(0,s.jsx)(n.td,{children:"16 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5c0f\u5199\u5341\u516d\u8fdb\u5236"}),(0,s.jsx)(n.td,{children:"VARCHAR(16)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u8ba2\u5355\u53f7"}),(0,s.jsx)(n.td,{children:"24 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5b57\u6bcd+\u6570\u5b57"}),(0,s.jsx)(n.td,{children:"VARCHAR(32)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u652f\u4ed8\u6d41\u6c34\u53f7"}),(0,s.jsx)(n.td,{children:"26 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5b57\u6bcd+\u6570\u5b57"}),(0,s.jsx)(n.td,{children:"VARCHAR(32)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"\u5e42\u7b49\u952e"}),(0,s.jsx)(n.td,{children:"\u7ea6 64 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5b57\u7b26\u4e32"}),(0,s.jsx)(n.td,{children:"Redis Key"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"UUID"}),(0,s.jsx)(n.td,{children:"32 \u4f4d"}),(0,s.jsx)(n.td,{children:"\u5c0f\u5199\u5341\u516d\u8fdb\u5236"}),(0,s.jsx)(n.td,{children:"VARCHAR(32)"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u5341\u4e8c\u94fe\u5f0f\u8c03\u7528\u89c4\u8303-must",children:"\u5341\u4e8c\u3001\u94fe\u5f0f\u8c03\u7528\u89c4\u8303 [MUST]"}),"\n",(0,s.jsx)(n.h3,{id:"121-\u9650\u5236\u89c4\u5219",children:"12.1 \u9650\u5236\u89c4\u5219"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - \u540c\u4e00\u7c7b\u5185\u7684\u94fe\u5f0f\u8c03\u7528\u5141\u8bb8\uff08\u5982 Builder \u6a21\u5f0f\uff09\n  - \u7ee7\u627f\u4f53\u7cfb\u4e2d\u7981\u6b62\u94fe\u5f0f\u8c03\u7528\uff08\u7c7b\u578b\u8f6c\u6362\u95ee\u9898\uff09\n"})}),"\n",(0,s.jsx)(n.h3,{id:"122-\u95ee\u9898\u793a\u4f8b",children:"12.2 \u95ee\u9898\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// \u274c \u9519\u8bef\uff1a\u7ee7\u627f\u4f53\u7cfb\u4e2d\u7684\u94fe\u5f0f\u8c03\u7528\n@Data\n@Accessors(chain = true)\npublic class BaseRequest { private String traceId; }\n\n@Data\n@Accessors(chain = true)\npublic class OrderRequest extends BaseRequest { private Long orderId; }\n\n// \u95ee\u9898\uff1asetTraceId() \u8fd4\u56de BaseRequest\uff0c\u65e0\u6cd5\u7ee7\u7eed\u8c03\u7528 setOrderId()\nOrderRequest request = new OrderRequest()\n    .setTraceId("123")      // \u8fd4\u56de BaseRequest\n    .setOrderId(1001L);     // \u7f16\u8bd1\u9519\u8bef\n'})}),"\n",(0,s.jsx)(n.h3,{id:"123-\u63a8\u8350\u65b9\u6848",children:"12.3 \u63a8\u8350\u65b9\u6848"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// \u2705 \u65b9\u68481\uff1a\u907f\u514d\u7ee7\u627f + \u94fe\u5f0f\u8c03\u7528\n// \u2705 \u65b9\u68482\uff1a\u4f7f\u7528 @Builder \u66ff\u4ee3 @Accessors(chain=true)\n@Builder\npublic class OrderRequest {\n    private String traceId;\n    private Long orderId;\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\u5341\u4e09\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",children:"\u5341\u4e09\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u5e8f\u53f7"}),(0,s.jsx)(n.th,{children:"\u53cd\u6a21\u5f0f"}),(0,s.jsx)(n.th,{children:"\u68c0\u6d4b\u65b9\u5f0f"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"\u7c7b\u540d\u7528\u5c0f\u9a7c\u5cf0"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 class \u58f0\u660e"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"\u53d8\u91cf\u7528\u5355\u5b57\u6bcd/\u62fc\u97f3"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5\u53d8\u91cf\u540d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"\u5e38\u91cf\u672a\u52a0 final"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 static \u53d8\u91cf"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"\u96c6\u5408\u4e0d\u6307\u5b9a\u5bb9\u91cf\u548c\u6cdb\u578b"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 new ArrayList/HashMap"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"\u541e\u5f02\u5e38\u6216 e.printStackTrace()"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 catch \u5757"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"\u5b57\u7b26\u4e32\u7528 == \u6bd4\u8f83"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 String \u6bd4\u8f83"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"\u5faa\u73af\u4e2d\u7528 + \u62fc\u63a5\u5b57\u7b26\u4e32"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 for \u5faa\u73af\u5185\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"\u591a\u5c42 if \u5224\u7a7a"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5\u5d4c\u5957 null \u5224\u65ad"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"9"}),(0,s.jsx)(n.td,{children:"\u4f7f\u7528 Executors \u521b\u5efa\u7ebf\u7a0b\u6c60"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 newFixedThreadPool \u7b49"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10"}),(0,s.jsx)(n.td,{children:"ThreadLocal \u672a remove"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 afterCompletion/finally"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"11"}),(0,s.jsx)(n.td,{children:"\u4f7f\u7528 SimpleDateFormat"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5\u65e5\u671f\u683c\u5f0f\u5316\u65b9\u5f0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"12"}),(0,s.jsx)(n.td,{children:"\u7f13\u5b58\u65e0\u8fc7\u671f\u65f6\u95f4"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 set \u65b9\u6cd5\u662f\u5426\u6709 expire \u53c2\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"13"}),(0,s.jsx)(n.td,{children:"\u6bcf\u6b21 new Snowflake"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5\u96ea\u82b1\u7b97\u6cd5\u4f7f\u7528\u65b9\u5f0f"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"14"}),(0,s.jsx)(n.td,{children:"\u6d41\u6c34\u53f7\u65e0\u968f\u673a\u7801"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5\u6d41\u6c34\u53f7\u751f\u6210\u903b\u8f91"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"15"}),(0,s.jsx)(n.td,{children:"\u5e42\u7b49\u952e\u65e0\u8fc7\u671f\u65f6\u95f4"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 Redis setIfAbsent"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"\u7ee7\u627f\u4f53\u7cfb\u4e2d\u4f7f\u7528 @Accessors(chain=true)"}),(0,s.jsx)(n.td,{children:"\u68c0\u67e5 extends + \u94fe\u5f0f\u6ce8\u89e3"})]})]})]})]})}function x(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>l});var d=r(6540);const s={},t=d.createContext(s);function i(e){const n=d.useContext(t);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),d.createElement(t.Provider,{value:n},e.children)}}}]);