"use strict";(globalThis.webpackChunkw3bank_knowledge_wiki=globalThis.webpackChunkw3bank_knowledge_wiki||[]).push([[5094],{7784(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>x,frontMatter:()=>l,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"L0-enterprise/governance/release-process","title":"\u53d1\u5e03\u6d41\u7a0b\u89c4\u8303","description":"\u4f01\u4e1a\u7ea7\u5f3a\u5236\u7ea6\u675f\uff0c\u786e\u4fdd\u53d1\u5e03\u5b89\u5168\u4e0e\u7cfb\u7edf\u7a33\u5b9a","source":"@site/docs/L0-enterprise/governance/release-process.md","sourceDirName":"L0-enterprise/governance","slug":"/L0-enterprise/governance/release-process","permalink":"/docs/L0-enterprise/governance/release-process","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/L0-enterprise/governance/release-process.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u5b89\u5168\u7ea2\u7ebf\u89c4\u8303","permalink":"/docs/L0-enterprise/constitution/security-baseline"},"next":{"title":"\u4ee3\u7801\u8bc4\u5ba1\u6d41\u7a0b\u89c4\u8303","permalink":"/docs/L0-enterprise/governance/review-process"}}');var t=s(4848),d=s(8453);const l={},i="\u53d1\u5e03\u6d41\u7a0b\u89c4\u8303",c={},h=[{value:"\u4e00\u3001\u73af\u5883\u9694\u79bb\u89c4\u8303 [MUST]",id:"\u4e00\u73af\u5883\u9694\u79bb\u89c4\u8303-must",level:2},{value:"1.1 \u56db\u7ea7\u73af\u5883",id:"11-\u56db\u7ea7\u73af\u5883",level:3},{value:"1.2 \u73af\u5883\u4e00\u81f4\u6027",id:"12-\u73af\u5883\u4e00\u81f4\u6027",level:3},{value:"1.3 \u751f\u4ea7\u73af\u5883\u7ea2\u7ebf",id:"13-\u751f\u4ea7\u73af\u5883\u7ea2\u7ebf",level:3},{value:"\u4e8c\u3001\u53d1\u5e03\u6d41\u7a0b [MUST]",id:"\u4e8c\u53d1\u5e03\u6d41\u7a0b-must",level:2},{value:"2.1 \u53d1\u5e03\u8981\u6c42",id:"21-\u53d1\u5e03\u8981\u6c42",level:3},{value:"2.2 \u53d8\u66f4\u5206\u7c7b",id:"22-\u53d8\u66f4\u5206\u7c7b",level:3},{value:"2.3 \u53d8\u66f4\u6d41\u7a0b",id:"23-\u53d8\u66f4\u6d41\u7a0b",level:3},{value:"\u4e09\u3001CI/CD \u6d41\u6c34\u7ebf\u89c4\u8303 [MUST]",id:"\u4e09cicd-\u6d41\u6c34\u7ebf\u89c4\u8303-must",level:2},{value:"3.1 \u6d41\u6c34\u7ebf\u9636\u6bb5",id:"31-\u6d41\u6c34\u7ebf\u9636\u6bb5",level:3},{value:"3.2 GitHub Actions \u914d\u7f6e",id:"32-github-actions-\u914d\u7f6e",level:3},{value:"3.3 \u8d28\u91cf\u95e8\u7981",id:"33-\u8d28\u91cf\u95e8\u7981",level:3},{value:"\u56db\u3001\u7070\u5ea6\u53d1\u5e03\u89c4\u8303 [MUST]",id:"\u56db\u7070\u5ea6\u53d1\u5e03\u89c4\u8303-must",level:2},{value:"4.1 K8s \u6eda\u52a8\u66f4\u65b0",id:"41-k8s-\u6eda\u52a8\u66f4\u65b0",level:3},{value:"4.2 \u6d41\u91cf\u7070\u5ea6\uff08Istio\uff09",id:"42-\u6d41\u91cf\u7070\u5ea6istio",level:3},{value:"4.3 \u7070\u5ea6\u7b56\u7565",id:"43-\u7070\u5ea6\u7b56\u7565",level:3},{value:"\u4e94\u3001\u56de\u6eda\u65b9\u6848 [MUST]",id:"\u4e94\u56de\u6eda\u65b9\u6848-must",level:2},{value:"5.1 \u56de\u6eda\u6b65\u9aa4",id:"51-\u56de\u6eda\u6b65\u9aa4",level:3},{value:"5.2 \u81ea\u52a8\u56de\u6eda\u89e6\u53d1\u6761\u4ef6",id:"52-\u81ea\u52a8\u56de\u6eda\u89e6\u53d1\u6761\u4ef6",level:3},{value:"\u516d\u3001\u76d1\u63a7\u544a\u8b66\u89c4\u8303 [MUST]",id:"\u516d\u76d1\u63a7\u544a\u8b66\u89c4\u8303-must",level:2},{value:"6.1 \u6838\u5fc3\u76d1\u63a7\u6307\u6807",id:"61-\u6838\u5fc3\u76d1\u63a7\u6307\u6807",level:3},{value:"6.2 \u544a\u8b66\u89c4\u5219",id:"62-\u544a\u8b66\u89c4\u5219",level:3},{value:"6.3 \u544a\u8b66\u5206\u7ea7",id:"63-\u544a\u8b66\u5206\u7ea7",level:3},{value:"\u4e03\u3001\u707e\u5907\u4e0e\u6062\u590d [MUST]",id:"\u4e03\u707e\u5907\u4e0e\u6062\u590d-must",level:2},{value:"7.1 \u5907\u4efd\u7b56\u7565",id:"71-\u5907\u4efd\u7b56\u7565",level:3},{value:"7.2 \u5907\u4efd\u9a8c\u8bc1",id:"72-\u5907\u4efd\u9a8c\u8bc1",level:3},{value:"\u516b\u3001\u4e8b\u6545\u54cd\u5e94 [MUST]",id:"\u516b\u4e8b\u6545\u54cd\u5e94-must",level:2},{value:"8.1 \u4e8b\u6545\u5206\u7ea7",id:"81-\u4e8b\u6545\u5206\u7ea7",level:3},{value:"\u4e5d\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",id:"\u4e5d\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",level:2}];function a(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u53d1\u5e03\u6d41\u7a0b\u89c4\u8303",children:"\u53d1\u5e03\u6d41\u7a0b\u89c4\u8303"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"\u4f01\u4e1a\u7ea7\u5f3a\u5236\u7ea6\u675f\uff0c\u786e\u4fdd\u53d1\u5e03\u5b89\u5168\u4e0e\u7cfb\u7edf\u7a33\u5b9a"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e00\u73af\u5883\u9694\u79bb\u89c4\u8303-must",children:"\u4e00\u3001\u73af\u5883\u9694\u79bb\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"11-\u56db\u7ea7\u73af\u5883",children:"1.1 \u56db\u7ea7\u73af\u5883"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u73af\u5883"}),(0,t.jsx)(n.th,{children:"\u7528\u9014"}),(0,t.jsx)(n.th,{children:"\u8d44\u6e90\u914d\u7f6e"}),(0,t.jsx)(n.th,{children:"\u6743\u9650\u7ba1\u63a7"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"dev"}),(0,t.jsx)(n.td,{children:"\u65e5\u5e38\u8c03\u8bd5"}),(0,t.jsx)(n.td,{children:"\u5355\u673a/\u8f7b\u91cf\u96c6\u7fa4"}),(0,t.jsx)(n.td,{children:"\u5f00\u53d1\u4eba\u5458\u53ef\u8bfb\u5199"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"test"}),(0,t.jsx)(n.td,{children:"\u529f\u80fd\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u5c0f\u578b\u96c6\u7fa4(2-3 \u8282\u70b9)"}),(0,t.jsx)(n.td,{children:"\u6d4b\u8bd5\u53ef\u8bfb\u5199\uff0c\u5f00\u53d1\u53ea\u8bfb"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"staging"}),(0,t.jsx)(n.td,{children:"\u56de\u5f52/\u6027\u80fd\u6d4b\u8bd5"}),(0,t.jsx)(n.td,{children:"\u4e0e\u751f\u4ea7\u4e00\u81f4"}),(0,t.jsx)(n.td,{children:"\u4ec5 CI/CD \u53ef\u90e8\u7f72"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"prod"}),(0,t.jsx)(n.td,{children:"\u751f\u4ea7"}),(0,t.jsx)(n.td,{children:"\u9ad8\u53ef\u7528\u96c6\u7fa4(\u22653 \u8282\u70b9)"}),(0,t.jsx)(n.td,{children:"\u4ec5 CI/CD \u53ef\u90e8\u7f72\uff0c\u7981\u6b62\u624b\u52a8"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"12-\u73af\u5883\u4e00\u81f4\u6027",children:"1.2 \u73af\u5883\u4e00\u81f4\u6027"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - Docker \u955c\u50cf\u7edf\u4e00\u57fa\u7840\u955c\u50cf\n  - Terraform \u7ba1\u7406\u57fa\u7840\u8bbe\u65bd\n  - Flyway \u7ba1\u7406\u6570\u636e\u5e93\u811a\u672c\n  - \u914d\u7f6e\u4e2d\u5fc3\u7ba1\u7406\u73af\u5883\u914d\u7f6e\n"})}),"\n",(0,t.jsx)(n.h3,{id:"13-\u751f\u4ea7\u73af\u5883\u7ea2\u7ebf",children:"1.3 \u751f\u4ea7\u73af\u5883\u7ea2\u7ebf"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"prohibited:\n  - \u624b\u52a8\u767b\u5f55\u670d\u52a1\u5668\u64cd\u4f5c\n  - \u624b\u52a8\u6267\u884c SQL \u811a\u672c\n  - \u4f7f\u7528 latest \u955c\u50cf\u6807\u7b7e\n  - \u660e\u6587\u5b58\u50a8\u654f\u611f\u914d\u7f6e\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e8c\u53d1\u5e03\u6d41\u7a0b-must",children:"\u4e8c\u3001\u53d1\u5e03\u6d41\u7a0b [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"21-\u53d1\u5e03\u8981\u6c42",children:"2.1 \u53d1\u5e03\u8981\u6c42"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'release_process:\n  - "\u751f\u4ea7\u53d1\u5e03\u5fc5\u987b\u7ecf\u8fc7 staging/pre-production \u73af\u5883\u9a8c\u8bc1"\n  - "\u53d1\u5e03\u5fc5\u987b\u6709\u53ef\u6267\u884c\u7684\u56de\u6eda\u65b9\u6848"\n  - "\u4e1a\u52a1\u9ad8\u5cf0\u671f\u7981\u6b62\u53d1\u5e03\uff08\u7531\u5404\u4e1a\u52a1\u7ebf\u5b9a\u4e49\u9ad8\u5cf0\u65f6\u6bb5\uff09"\n  - "\u53d1\u5e03\u540e\u5fc5\u987b\u8fdb\u884c\u5192\u70df\u6d4b\u8bd5\u9a8c\u8bc1"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"22-\u53d8\u66f4\u5206\u7c7b",children:"2.2 \u53d8\u66f4\u5206\u7c7b"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u5b9a\u4e49"}),(0,t.jsx)(n.th,{children:"\u5ba1\u6279\u7ea7\u522b"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5fae\u5c0f\u53d8\u66f4"}),(0,t.jsx)(n.td,{children:"\u8c03\u6574\u65e5\u5fd7\u7ea7\u522b\u3001\u65b0\u589e\u76d1\u63a7\u6307\u6807"}),(0,t.jsx)(n.td,{children:"\u5f00\u53d1\u8d1f\u8d23\u4eba"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u4e00\u822c\u53d8\u66f4"}),(0,t.jsx)(n.td,{children:"\u65b0\u589e\u63a5\u53e3\u3001\u4f18\u5316 SQL \u7d22\u5f15"}),(0,t.jsx)(n.td,{children:"\u6280\u672f\u8d1f\u8d23\u4eba"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u91cd\u5927\u53d8\u66f4"}),(0,t.jsx)(n.td,{children:"\u5206\u5e93\u5206\u8868\u3001JVM \u53c2\u6570\u8c03\u6574\u3001\u6846\u67b6\u5347\u7ea7"}),(0,t.jsx)(n.td,{children:"\u6280\u672f+\u4ea7\u54c1+\u8fd0\u7ef4\u8054\u5408\u5ba1\u6279"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"23-\u53d8\u66f4\u6d41\u7a0b",children:"2.3 \u53d8\u66f4\u6d41\u7a0b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"before:\n  - \u767b\u8bb0 CMDB\uff08\u53d8\u66f4\u5185\u5bb9\u3001\u5f71\u54cd\u8303\u56f4\u3001\u6267\u884c\u65f6\u95f4\uff09\n  - \u51c6\u5907\u56de\u6eda\u65b9\u6848\n  - \u975e\u4e1a\u52a1\u9ad8\u5cf0\u671f\u6267\u884c\n\nduring:\n  - \u7070\u5ea6\u53d1\u5e03\uff08\u5148 1 \u4e2a Pod\uff0c\u89c2\u5bdf 10 \u5206\u949f\uff09\n  - \u6162\u542f\u52a8\uff08preStop \u5ef6\u8fdf 10 \u79d2\uff09\n  - \u5b9e\u65f6\u76d1\u63a7\u6307\u6807\n\nafter:\n  - \u5f00\u53d1\u9a8c\u8bc1\n  - \u6d4b\u8bd5\u9a8c\u8bc1\n  - \u89c2\u5bdf 30 \u5206\u949f\n  - \u65e0\u5f02\u5e38\u6807\u8bb0\u5b8c\u6210\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e09cicd-\u6d41\u6c34\u7ebf\u89c4\u8303-must",children:"\u4e09\u3001CI/CD \u6d41\u6c34\u7ebf\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"31-\u6d41\u6c34\u7ebf\u9636\u6bb5",children:"3.1 \u6d41\u6c34\u7ebf\u9636\u6bb5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"stages:\n  - code-check      # \u4ee3\u7801\u68c0\u67e5\uff08SonarQube\uff09\n  - test            # \u5355\u5143\u6d4b\u8bd5 + \u96c6\u6210\u6d4b\u8bd5\n  - build           # \u6784\u5efa Docker \u955c\u50cf\n  - scan            # \u955c\u50cf\u5b89\u5168\u626b\u63cf\n  - deploy          # K8s \u90e8\u7f72\n  - verify          # \u90e8\u7f72\u9a8c\u8bc1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"32-github-actions-\u914d\u7f6e",children:"3.2 GitHub Actions \u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"name: CI/CD Pipeline\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\nenv:\n  IMAGE_REGISTRY: ghcr.io/${{ github.repository_owner }}\n  APP_NAME: mall-order\n\njobs:\n  code-check:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: SonarQube Scan\n        uses: sonarsource/sonarqube-scan-action@master\n        env:\n          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}\n\n  test:\n    runs-on: ubuntu-latest\n    needs: code-check\n    steps:\n      - name: Run Tests with Coverage\n        run: mvn clean test jacoco:report\n\n  build:\n    runs-on: ubuntu-latest\n    needs: test\n    outputs:\n      image_tag: ${{ steps.meta.outputs.tags }}\n    steps:\n      - name: Build and Push\n        uses: docker/build-push-action@v5\n        with:\n          context: .\n          push: true\n          tags: ${{ steps.meta.outputs.tags }}\n\n  scan:\n    runs-on: ubuntu-latest\n    needs: build\n    steps:\n      - name: Run Trivy vulnerability scanner\n        uses: aquasecurity/trivy-action@master\n        with:\n          image-ref: ${{ needs.build.outputs.image_tag }}\n          severity: 'HIGH,CRITICAL'\n          exit-code: '1'\n\n  deploy:\n    runs-on: ubuntu-latest\n    needs: [build, scan]\n    if: github.ref == 'refs/heads/main'\n    environment: production\n    steps:\n      - name: Deploy to Kubernetes\n        run: |\n          helm upgrade --install ${{ env.APP_NAME }} ./charts/${{ env.APP_NAME }} \\\n            --namespace prod \\\n            --set image.tag=v1.0.0-${{ github.sha }} \\\n            --set replicas=3 \\\n            --wait --timeout=5m\n\n  verify:\n    runs-on: ubuntu-latest\n    needs: deploy\n    steps:\n      - name: Run API Tests\n        id: api-test\n        continue-on-error: true\n        run: |\n          newman run test/api-test.json -e test/prod-environment.json\n\n      - name: Rollback on Failure\n        if: steps.api-test.outcome == 'failure'\n        run: |\n          helm rollback ${{ env.APP_NAME }} 0 --namespace prod\n          curl -X POST -d '{\"msg\":\"\u90e8\u7f72\u5931\u8d25\uff0c\u5df2\u81ea\u52a8\u56de\u6eda\"}' ${{ secrets.WEBHOOK_URL }}\n          exit 1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"33-\u8d28\u91cf\u95e8\u7981",children:"3.3 \u8d28\u91cf\u95e8\u7981"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"quality_gates:\n  - sonarqube_no_critical_issues\n  - unit_test_coverage >= 80%\n  - security_scan_passed\n  - all_tests_passed\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u56db\u7070\u5ea6\u53d1\u5e03\u89c4\u8303-must",children:"\u56db\u3001\u7070\u5ea6\u53d1\u5e03\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"41-k8s-\u6eda\u52a8\u66f4\u65b0",children:"4.1 K8s \u6eda\u52a8\u66f4\u65b0"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"strategy:\n  type: RollingUpdate\n  rollingUpdate:\n    maxUnavailable: 0    # \u96f6\u505c\u673a\n    maxSurge: 1          # \u6700\u591a\u591a\u542f\u52a8 1 \u4e2a Pod\n"})}),"\n",(0,t.jsx)(n.h3,{id:"42-\u6d41\u91cf\u7070\u5ea6istio",children:"4.2 \u6d41\u91cf\u7070\u5ea6\uff08Istio\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nspec:\n  http:\n    - match:\n        - headers:\n            x-canary:\n              exact: "true"\n      route:\n        - destination:\n            host: mall-order\n            subset: canary\n    - route:\n        - destination:\n            host: mall-order\n            subset: stable\n'})}),"\n",(0,t.jsx)(n.h3,{id:"43-\u7070\u5ea6\u7b56\u7565",children:"4.3 \u7070\u5ea6\u7b56\u7565"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"canary_steps:\n  1. \u90e8\u7f72 canary \u7248\u672c\uff081 \u4e2a Pod\uff09\n  2. \u89c2\u5bdf 10 \u5206\u949f\uff0c\u68c0\u67e5\u9519\u8bef\u7387\u3001RT\n  3. \u6269\u5c55\u5230 30% \u6d41\u91cf\n  4. \u89c2\u5bdf 30 \u5206\u949f\n  5. \u5168\u91cf\u53d1\u5e03\n  6. \u6e05\u7406 canary \u8d44\u6e90\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e94\u56de\u6eda\u65b9\u6848-must",children:"\u4e94\u3001\u56de\u6eda\u65b9\u6848 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"51-\u56de\u6eda\u6b65\u9aa4",children:"5.1 \u56de\u6eda\u6b65\u9aa4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"rollback_steps:\n  1. \u56de\u6eda\u4ee3\u7801\uff08helm rollback\uff09\n  2. \u56de\u6eda\u6570\u636e\u5e93\uff08\u6267\u884c\u56de\u6eda\u811a\u672c\uff09\n  3. \u6e05\u7406\u7f13\u5b58\uff08Redis \u5220\u9664\u76f8\u5173 key\uff09\n  4. \u901a\u77e5\u56e2\u961f\n"})}),"\n",(0,t.jsx)(n.h3,{id:"52-\u81ea\u52a8\u56de\u6eda\u89e6\u53d1\u6761\u4ef6",children:"5.2 \u81ea\u52a8\u56de\u6eda\u89e6\u53d1\u6761\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"auto_rollback_triggers:\n  - \u9519\u8bef\u7387 > 5% \u6301\u7eed 2 \u5206\u949f\n  - P99 \u54cd\u5e94\u65f6\u95f4 > 2s \u6301\u7eed 5 \u5206\u949f\n  - \u5065\u5eb7\u68c0\u67e5\u8fde\u7eed\u5931\u8d25 3 \u6b21\n  - \u5192\u70df\u6d4b\u8bd5\u5931\u8d25\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u516d\u76d1\u63a7\u544a\u8b66\u89c4\u8303-must",children:"\u516d\u3001\u76d1\u63a7\u544a\u8b66\u89c4\u8303 [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"61-\u6838\u5fc3\u76d1\u63a7\u6307\u6807",children:"6.1 \u6838\u5fc3\u76d1\u63a7\u6307\u6807"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"application:\n  - http_requests_total          # \u8bf7\u6c42\u603b\u6570\n  - http_request_duration_seconds  # \u8bf7\u6c42\u8017\u65f6\n  - http_requests_errors_total   # \u9519\u8bef\u6570\n\njvm:\n  - jvm_memory_used_bytes        # \u5185\u5b58\u4f7f\u7528\n  - jvm_gc_pause_seconds         # GC \u6682\u505c\u65f6\u95f4\n  - jvm_threads_current          # \u7ebf\u7a0b\u6570\n\nbusiness:\n  - order_create_total           # \u8ba2\u5355\u521b\u5efa\u6570\n  - payment_success_total        # \u652f\u4ed8\u6210\u529f\u6570\n"})}),"\n",(0,t.jsx)(n.h3,{id:"62-\u544a\u8b66\u89c4\u5219",children:"6.2 \u544a\u8b66\u89c4\u5219"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: app-alerts\n    rules:\n      - alert: \u63a5\u53e3\u9519\u8bef\u7387\u8fc7\u9ad8\n        expr: rate(http_requests_errors_total[5m]) / rate(http_requests_total[5m]) > 0.05\n        for: 1m\n        labels:\n          severity: critical\n        annotations:\n          summary: "\u63a5\u53e3\u9519\u8bef\u7387\u8d85\u8fc7 5%"\n\n      - alert: P99 \u54cd\u5e94\u65f6\u95f4\u8fc7\u9ad8\n        expr: histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m])) > 1\n        for: 2m\n        labels:\n          severity: warning\n        annotations:\n          summary: "P99 \u54cd\u5e94\u65f6\u95f4\u8d85\u8fc7 1 \u79d2"\n\n      - alert: JVM \u5185\u5b58\u4f7f\u7528\u7387\u8fc7\u9ad8\n        expr: jvm_memory_used_bytes / jvm_memory_max_bytes > 0.85\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "JVM \u5185\u5b58\u4f7f\u7528\u7387\u8d85\u8fc7 85%"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"63-\u544a\u8b66\u5206\u7ea7",children:"6.3 \u544a\u8b66\u5206\u7ea7"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,t.jsx)(n.th,{children:"\u89e6\u53d1\u573a\u666f"}),(0,t.jsx)(n.th,{children:"\u901a\u77e5\u65b9\u5f0f"}),(0,t.jsx)(n.th,{children:"\u54cd\u5e94\u65f6\u6548"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Critical"}),(0,t.jsx)(n.td,{children:"\u670d\u52a1\u5b95\u673a\u3001\u9519\u8bef\u7387 >5%"}),(0,t.jsx)(n.td,{children:"\u9489\u9489@\u6240\u6709\u4eba+\u7535\u8bdd"}),(0,t.jsx)(n.td,{children:"5 \u5206\u949f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Warning"}),(0,t.jsx)(n.td,{children:"\u5185\u5b58 >85%\u3001\u6162\u67e5\u8be2\u589e\u591a"}),(0,t.jsx)(n.td,{children:"\u9489\u9489\u7fa4\u901a\u77e5"}),(0,t.jsx)(n.td,{children:"30 \u5206\u949f"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Info"}),(0,t.jsx)(n.td,{children:"\u914d\u7f6e\u66f4\u65b0\u3001\u670d\u52a1\u91cd\u542f"}),(0,t.jsx)(n.td,{children:"\u90ae\u4ef6\u901a\u77e5"}),(0,t.jsx)(n.td,{children:"\u65e0\u9700\u5373\u65f6"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e03\u707e\u5907\u4e0e\u6062\u590d-must",children:"\u4e03\u3001\u707e\u5907\u4e0e\u6062\u590d [MUST]"}),"\n",(0,t.jsx)(n.h3,{id:"71-\u5907\u4efd\u7b56\u7565",children:"7.1 \u5907\u4efd\u7b56\u7565"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u6570\u636e\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u5907\u4efd\u9891\u7387"}),(0,t.jsx)(n.th,{children:"\u5907\u4efd\u65b9\u5f0f"}),(0,t.jsx)(n.th,{children:"\u4fdd\u7559\u65f6\u957f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u8ba2\u5355/\u652f\u4ed8\uff08\u6838\u5fc3\uff09"}),(0,t.jsx)(n.td,{children:"\u5168\u91cf\u6bcf\u65e5+\u589e\u91cf\u6bcf\u5c0f\u65f6"}),(0,t.jsx)(n.td,{children:"MySQL \u4e3b\u4ece+\u5b9a\u65f6\u5907\u4efd"}),(0,t.jsx)(n.td,{children:"90 \u5929"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u7528\u6237\u6570\u636e\uff08\u91cd\u8981\uff09"}),(0,t.jsx)(n.td,{children:"\u5168\u91cf\u6bcf\u65e5+\u589e\u91cf\u6bcf 2 \u5c0f\u65f6"}),(0,t.jsx)(n.td,{children:"\u5168\u91cf\u5907\u4efd+Binlog"}),(0,t.jsx)(n.td,{children:"180 \u5929"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u65e5\u5fd7/\u7edf\u8ba1\uff08\u975e\u6838\u5fc3\uff09"}),(0,t.jsx)(n.td,{children:"\u5168\u91cf\u6bcf\u65e5"}),(0,t.jsx)(n.td,{children:"\u538b\u7f29\u5b58\u50a8"}),(0,t.jsx)(n.td,{children:"30 \u5929"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"72-\u5907\u4efd\u9a8c\u8bc1",children:"7.2 \u5907\u4efd\u9a8c\u8bc1"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# \u6bcf\u5468\u81ea\u52a8\u6267\u884c\u6062\u590d\u6d4b\u8bd5\n\n# 1. \u4e0b\u8f7d\u6700\u65b0\u5907\u4efd\nwget http://backup.mall.com/mysql/full-$(date +%Y%m%d).sql.gz\n\n# 2. \u6062\u590d\u5230\u6d4b\u8bd5\u5e93\ngunzip full-$(date +%Y%m%d).sql.gz\nmysql -h test-db -u test -p$TEST_PWD < full-$(date +%Y%m%d).sql\n\n# 3. \u6821\u9a8c\u6570\u636e\u5b8c\u6574\u6027\nprod_count=$(mysql -h prod-db -e "select count(*) from order_info" -N)\ntest_count=$(mysql -h test-db -e "select count(*) from order_info" -N)\nif [ $prod_count -eq $test_count ]; then\n    echo "\u5907\u4efd\u6062\u590d\u6210\u529f"\nelse\n    curl -X POST -d \'{"msg":"\u5907\u4efd\u6062\u590d\u5931\u8d25"}\' $DINGTALK_WEBHOOK\nfi\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u516b\u4e8b\u6545\u54cd\u5e94-must",children:"\u516b\u3001\u4e8b\u6545\u54cd\u5e94 [MUST]"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'incident_response:\n  - "P0/P1 \u4e8b\u6545\u5fc5\u987b\u5728 15 \u5206\u949f\u5185\u54cd\u5e94"\n  - "\u4e8b\u6545\u5904\u7406\u5fc5\u987b\u8bb0\u5f55\u65f6\u95f4\u7ebf\u548c\u5904\u7406\u8fc7\u7a0b"\n  - "\u4e8b\u6545\u5fc5\u987b\u8fdb\u884c\u590d\u76d8\u5e76\u8f93\u51fa\u6539\u8fdb\u63aa\u65bd"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"81-\u4e8b\u6545\u5206\u7ea7",children:"8.1 \u4e8b\u6545\u5206\u7ea7"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u7ea7\u522b"}),(0,t.jsx)(n.th,{children:"\u5b9a\u4e49"}),(0,t.jsx)(n.th,{children:"\u54cd\u5e94\u65f6\u95f4"}),(0,t.jsx)(n.th,{children:"\u5904\u7406\u65f6\u95f4"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"P0"}),(0,t.jsx)(n.td,{children:"\u6838\u5fc3\u4e1a\u52a1\u4e0d\u53ef\u7528"}),(0,t.jsx)(n.td,{children:"5 \u5206\u949f"}),(0,t.jsx)(n.td,{children:"1 \u5c0f\u65f6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"P1"}),(0,t.jsx)(n.td,{children:"\u6838\u5fc3\u4e1a\u52a1\u4e25\u91cd\u53d7\u635f"}),(0,t.jsx)(n.td,{children:"15 \u5206\u949f"}),(0,t.jsx)(n.td,{children:"4 \u5c0f\u65f6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"P2"}),(0,t.jsx)(n.td,{children:"\u975e\u6838\u5fc3\u529f\u80fd\u4e0d\u53ef\u7528"}),(0,t.jsx)(n.td,{children:"30 \u5206\u949f"}),(0,t.jsx)(n.td,{children:"8 \u5c0f\u65f6"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"P3"}),(0,t.jsx)(n.td,{children:"\u8f7b\u5fae\u95ee\u9898"}),(0,t.jsx)(n.td,{children:"2 \u5c0f\u65f6"}),(0,t.jsx)(n.td,{children:"24 \u5c0f\u65f6"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"\u4e5d\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",children:"\u4e5d\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u5e8f\u53f7"}),(0,t.jsx)(n.th,{children:"\u53cd\u6a21\u5f0f"}),(0,t.jsx)(n.th,{children:"\u68c0\u6d4b\u65b9\u5f0f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"\u955c\u50cf\u6807\u7b7e\u7528 latest"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 Deployment \u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"2"}),(0,t.jsx)(n.td,{children:"\u5bb9\u5668\u65e0\u8d44\u6e90\u9650\u5236"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 resources \u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"3"}),(0,t.jsx)(n.td,{children:"\u65e0\u6eda\u52a8\u66f4\u65b0\u914d\u7f6e"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 strategy \u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"4"}),(0,t.jsx)(n.td,{children:"\u5907\u4efd\u672a\u9a8c\u8bc1"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6062\u590d\u6d4b\u8bd5\u8bb0\u5f55"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"5"}),(0,t.jsx)(n.td,{children:"\u76d1\u63a7\u4ec5\u8986\u76d6\u6307\u6807"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u65e5\u5fd7+\u94fe\u8def\u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"6"}),(0,t.jsx)(n.td,{children:"\u654f\u611f\u914d\u7f6e\u660e\u6587\u5b58\u50a8"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 ConfigMap/Secret"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"7"}),(0,t.jsx)(n.td,{children:"\u751f\u4ea7\u73af\u5883\u624b\u52a8\u90e8\u7f72"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u90e8\u7f72\u8bb0\u5f55"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"8"}),(0,t.jsx)(n.td,{children:"\u65e0\u5065\u5eb7\u68c0\u67e5\u63a2\u9488"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5 liveness/readiness"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"9"}),(0,t.jsx)(n.td,{children:"CI/CD \u65e0\u8d28\u91cf\u95e8\u7981"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u6d41\u6c34\u7ebf\u914d\u7f6e"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"10"}),(0,t.jsx)(n.td,{children:"\u4e1a\u52a1\u9ad8\u5cf0\u671f\u53d1\u5e03"}),(0,t.jsx)(n.td,{children:"\u68c0\u67e5\u53d1\u5e03\u65f6\u95f4\u8bb0\u5f55"})]})]})]})]})}function x(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const t={},d=r.createContext(t);function l(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);