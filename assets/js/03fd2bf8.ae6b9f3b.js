"use strict";(globalThis.webpackChunkw3bank_knowledge_wiki=globalThis.webpackChunkw3bank_knowledge_wiki||[]).push([[748],{144(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"L0-enterprise/standards/api-design-guide","title":"API \u8bbe\u8ba1\u89c4\u8303","description":"\u4f01\u4e1a\u7ea7 API \u8bbe\u8ba1\u57fa\u7ebf\uff0c\u9002\u7528\u4e8e RESTful API \u8bbe\u8ba1\u3001Controller \u7f16\u5199\u3001\u63a5\u53e3\u6587\u6863\u573a\u666f","source":"@site/docs/L0-enterprise/standards/api-design-guide.md","sourceDirName":"L0-enterprise/standards","slug":"/L0-enterprise/standards/api-design-guide","permalink":"/docs-engine/docs/L0-enterprise/standards/api-design-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/L0-enterprise/standards/api-design-guide.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u4ee3\u7801\u8bc4\u5ba1\u6d41\u7a0b\u89c4\u8303","permalink":"/docs-engine/docs/L0-enterprise/governance/review-process"},"next":{"title":"Java \u7f16\u7801\u89c4\u8303","permalink":"/docs-engine/docs/L0-enterprise/standards/coding-standards/java"}}');var d=r(4848),i=r(8453);const t={},l="API \u8bbe\u8ba1\u89c4\u8303",a={},c=[{value:"\u4e00\u3001RESTful \u8bed\u4e49\u89c4\u8303 [MUST]",id:"\u4e00restful-\u8bed\u4e49\u89c4\u8303-must",level:2},{value:"1.1 HTTP \u65b9\u6cd5\u6620\u5c04",id:"11-http-\u65b9\u6cd5\u6620\u5c04",level:3},{value:"1.2 URL \u8bbe\u8ba1\u89c4\u8303",id:"12-url-\u8bbe\u8ba1\u89c4\u8303",level:3},{value:"1.3 \u67e5\u8be2\u53c2\u6570\u89c4\u8303",id:"13-\u67e5\u8be2\u53c2\u6570\u89c4\u8303",level:3},{value:"\u4e8c\u3001\u8bf7\u6c42\u89c4\u8303 [MUST]",id:"\u4e8c\u8bf7\u6c42\u89c4\u8303-must",level:2},{value:"2.1 \u8bf7\u6c42 DTO \u8bbe\u8ba1",id:"21-\u8bf7\u6c42-dto-\u8bbe\u8ba1",level:3},{value:"2.2 Controller \u53c2\u6570\u6821\u9a8c",id:"22-controller-\u53c2\u6570\u6821\u9a8c",level:3},{value:"\u4e09\u3001\u54cd\u5e94\u89c4\u8303 [MUST]",id:"\u4e09\u54cd\u5e94\u89c4\u8303-must",level:2},{value:"3.1 \u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",id:"31-\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",level:3},{value:"3.2 \u4e1a\u52a1\u72b6\u6001\u7801\u89c4\u8303",id:"32-\u4e1a\u52a1\u72b6\u6001\u7801\u89c4\u8303",level:3},{value:"3.3 \u5206\u9875\u54cd\u5e94\u7ed3\u6784",id:"33-\u5206\u9875\u54cd\u5e94\u7ed3\u6784",level:3},{value:"3.4 \u54cd\u5e94\u793a\u4f8b",id:"34-\u54cd\u5e94\u793a\u4f8b",level:3},{value:"\u56db\u3001\u5168\u5c40\u5f02\u5e38\u5904\u7406 [MUST]",id:"\u56db\u5168\u5c40\u5f02\u5e38\u5904\u7406-must",level:2},{value:"\u4e94\u3001\u63a5\u53e3\u6587\u6863\u89c4\u8303 [MUST]",id:"\u4e94\u63a5\u53e3\u6587\u6863\u89c4\u8303-must",level:2},{value:"5.1 SpringDoc \u914d\u7f6e",id:"51-springdoc-\u914d\u7f6e",level:3},{value:"5.2 Controller \u6587\u6863\u6ce8\u89e3",id:"52-controller-\u6587\u6863\u6ce8\u89e3",level:3},{value:"\u516d\u3001\u7248\u672c\u63a7\u5236\u89c4\u8303 [MUST]",id:"\u516d\u7248\u672c\u63a7\u5236\u89c4\u8303-must",level:2},{value:"6.1 \u7248\u672c\u7b56\u7565",id:"61-\u7248\u672c\u7b56\u7565",level:3},{value:"6.2 \u63a5\u53e3\u5e9f\u5f03\u6d41\u7a0b",id:"62-\u63a5\u53e3\u5e9f\u5f03\u6d41\u7a0b",level:3},{value:"\u4e03\u3001\u5b89\u5168\u89c4\u8303 [MUST]",id:"\u4e03\u5b89\u5168\u89c4\u8303-must",level:2},{value:"7.1 \u63a5\u53e3\u9650\u6d41",id:"71-\u63a5\u53e3\u9650\u6d41",level:3},{value:"7.2 \u5e42\u7b49\u6027\u8bbe\u8ba1",id:"72-\u5e42\u7b49\u6027\u8bbe\u8ba1",level:3},{value:"7.3 \u654f\u611f\u6570\u636e\u8131\u654f",id:"73-\u654f\u611f\u6570\u636e\u8131\u654f",level:3},{value:"\u516b\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",id:"\u516b\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"api-\u8bbe\u8ba1\u89c4\u8303",children:"API \u8bbe\u8ba1\u89c4\u8303"})}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"\u4f01\u4e1a\u7ea7 API \u8bbe\u8ba1\u57fa\u7ebf\uff0c\u9002\u7528\u4e8e RESTful API \u8bbe\u8ba1\u3001Controller \u7f16\u5199\u3001\u63a5\u53e3\u6587\u6863\u573a\u666f"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u4e00restful-\u8bed\u4e49\u89c4\u8303-must",children:"\u4e00\u3001RESTful \u8bed\u4e49\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"11-http-\u65b9\u6cd5\u6620\u5c04",children:"1.1 HTTP \u65b9\u6cd5\u6620\u5c04"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u64cd\u4f5c"}),(0,d.jsx)(n.th,{children:"HTTP \u65b9\u6cd5"}),(0,d.jsx)(n.th,{children:"\u5e42\u7b49\u6027"}),(0,d.jsx)(n.th,{children:"URL \u793a\u4f8b"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u67e5\u8be2\u5355\u4e2a"}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"GET /api/v1/orders/{orderId}"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u67e5\u8be2\u5217\u8868"}),(0,d.jsx)(n.td,{children:"GET"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"GET /api/v1/orders?status=1&pageNum=1"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u521b\u5efa"}),(0,d.jsx)(n.td,{children:"POST"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"POST /api/v1/orders"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5168\u91cf\u66f4\u65b0"}),(0,d.jsx)(n.td,{children:"PUT"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PUT /api/v1/orders/{orderId}"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u90e8\u5206\u66f4\u65b0"}),(0,d.jsx)(n.td,{children:"PATCH"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"PATCH /api/v1/orders/{orderId}"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5220\u9664"}),(0,d.jsx)(n.td,{children:"DELETE"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"DELETE /api/v1/orders/{orderId}"})})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"12-url-\u8bbe\u8ba1\u89c4\u8303",children:"1.2 URL \u8bbe\u8ba1\u89c4\u8303"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"rules:\n  - \u4f7f\u7528\u540d\u8bcd\u590d\u6570\uff0c\u7981\u6b62\u52a8\u8bcd\n  - \u5168\u5c0f\u5199\uff0c\u8fde\u5b57\u7b26\u5206\u9694\n  - \u5c42\u7ea7\u6e05\u6670\uff0c\u4e0d\u8d85\u8fc7 3 \u7ea7\n  - \u7248\u672c\u53f7\u653e\u5728\u8def\u5f84\u4e2d\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e URL\nGET    /api/v1/users                    // \u7528\u6237\u5217\u8868\nGET    /api/v1/users/{userId}           // \u7528\u6237\u8be6\u60c5\nPOST   /api/v1/users                    // \u521b\u5efa\u7528\u6237\nPUT    /api/v1/users/{userId}           // \u66f4\u65b0\u7528\u6237\nDELETE /api/v1/users/{userId}           // \u5220\u9664\u7528\u6237\nGET    /api/v1/users/{userId}/orders    // \u7528\u6237\u7684\u8ba2\u5355\u5217\u8868\n\n// \u274c \u9519\u8bef URL\nGET    /api/v1/getUser                  // \u52a8\u8bcd\nGET    /api/v1/user                     // \u5355\u6570\nGET    /api/v1/User                     // \u5927\u5199\nPOST   /api/v1/createOrder              // \u52a8\u8bcd\nGET    /api/v1/user_list                // \u4e0b\u5212\u7ebf\n"})}),"\n",(0,d.jsx)(n.h3,{id:"13-\u67e5\u8be2\u53c2\u6570\u89c4\u8303",children:"1.3 \u67e5\u8be2\u53c2\u6570\u89c4\u8303"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"query_params:\n  - pageNum: \u9875\u7801\uff08\u4ece 1 \u5f00\u59cb\uff09\n  - pageSize: \u6bcf\u9875\u6761\u6570\n  - sortBy: \u6392\u5e8f\u5b57\u6bb5\n  - sortOrder: \u6392\u5e8f\u65b9\u5411\uff08asc/desc\uff09\n  - \u4e1a\u52a1\u8fc7\u6ee4\u5b57\u6bb5\u4f7f\u7528\u5c0f\u9a7c\u5cf0\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:"// \u2705 \u6b63\u786e\nGET /api/v1/orders?userId=1001&status=1&pageNum=1&pageSize=10&sortBy=createTime&sortOrder=desc\n\n// \u274c \u9519\u8bef\nGET /api/v1/orders?user_id=1001&page=1   // \u547d\u540d\u4e0d\u4e00\u81f4\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u4e8c\u8bf7\u6c42\u89c4\u8303-must",children:"\u4e8c\u3001\u8bf7\u6c42\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"21-\u8bf7\u6c42-dto-\u8bbe\u8ba1",children:"2.1 \u8bf7\u6c42 DTO \u8bbe\u8ba1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@Data\n@Schema(description = "\u8ba2\u5355\u521b\u5efa\u8bf7\u6c42")\npublic class OrderCreateRequest {\n\n    @NotNull(message = "\u7528\u6237 ID \u4e0d\u80fd\u4e3a\u7a7a")\n    @Schema(description = "\u7528\u6237 ID", example = "1001", required = true)\n    private Long userId;\n\n    @NotEmpty(message = "\u5546\u54c1\u5217\u8868\u4e0d\u80fd\u4e3a\u7a7a")\n    @Size(min = 1, max = 100, message = "\u5546\u54c1\u6570\u91cf 1-100 \u4ef6")\n    @Schema(description = "\u5546\u54c1\u5217\u8868", required = true)\n    private List<OrderItemDTO> items;\n\n    @NotNull(message = "\u8ba2\u5355\u91d1\u989d\u4e0d\u80fd\u4e3a\u7a7a")\n    @DecimalMin(value = "0.01", message = "\u8ba2\u5355\u91d1\u989d\u5fc5\u987b\u5927\u4e8e 0")\n    @Schema(description = "\u8ba2\u5355\u91d1\u989d", example = "299.00", required = true)\n    private BigDecimal amount;\n\n    @Schema(description = "\u6536\u8d27\u5730\u5740 ID")\n    private Long addressId;\n\n    @Size(max = 200, message = "\u5907\u6ce8\u4e0d\u8d85\u8fc7 200 \u5b57")\n    @Schema(description = "\u8ba2\u5355\u5907\u6ce8")\n    private String remark;\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"22-controller-\u53c2\u6570\u6821\u9a8c",children:"2.2 Controller \u53c2\u6570\u6821\u9a8c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("/api/v1/orders")\n@Validated\npublic class OrderController {\n\n    // \u8bf7\u6c42\u4f53\u6821\u9a8c\n    @PostMapping\n    public Result<Long> createOrder(@Valid @RequestBody OrderCreateRequest request) {\n        return Result.success(orderService.createOrder(request));\n    }\n\n    // \u8def\u5f84\u53c2\u6570\u6821\u9a8c\n    @GetMapping("/{orderId}")\n    public Result<OrderVO> getOrder(\n            @PathVariable @Min(value = 1, message = "\u8ba2\u5355 ID \u5fc5\u987b\u5927\u4e8e 0") Long orderId) {\n        return Result.success(orderService.getOrderById(orderId));\n    }\n\n    // \u67e5\u8be2\u53c2\u6570\u6821\u9a8c\n    @GetMapping\n    public Result<PageInfo<OrderVO>> listOrders(\n            @RequestParam @NotNull(message = "\u7528\u6237 ID \u4e0d\u80fd\u4e3a\u7a7a") Long userId,\n            @RequestParam(defaultValue = "1") @Min(1) Integer pageNum,\n            @RequestParam(defaultValue = "10") @Max(100) Integer pageSize) {\n        return Result.success(orderService.listOrders(userId, pageNum, pageSize));\n    }\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u4e09\u54cd\u5e94\u89c4\u8303-must",children:"\u4e09\u3001\u54cd\u5e94\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"31-\u7edf\u4e00\u54cd\u5e94\u7ed3\u6784",children:"3.1 \u7edf\u4e00\u54cd\u5e94\u7ed3\u6784"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class Result<T> {\n\n    @Schema(description = "\u4e1a\u52a1\u72b6\u6001\u7801", example = "200")\n    private int code;\n\n    @Schema(description = "\u63d0\u793a\u6d88\u606f", example = "\u6210\u529f")\n    private String msg;\n\n    @Schema(description = "\u54cd\u5e94\u6570\u636e")\n    private T data;\n\n    @Schema(description = "\u54cd\u5e94\u65f6\u95f4\u6233", example = "1704067200000")\n    private long timestamp;\n\n    public static <T> Result<T> success(T data) {\n        return new Result<>(200, "\u6210\u529f", data, System.currentTimeMillis());\n    }\n\n    public static Result<Void> success() {\n        return new Result<>(200, "\u6210\u529f", null, System.currentTimeMillis());\n    }\n\n    public static Result<Void> fail(int code, String msg) {\n        return new Result<>(code, msg, null, System.currentTimeMillis());\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"32-\u4e1a\u52a1\u72b6\u6001\u7801\u89c4\u8303",children:"3.2 \u4e1a\u52a1\u72b6\u6001\u7801\u89c4\u8303"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7801\u6bb5"}),(0,d.jsx)(n.th,{children:"\u542b\u4e49"}),(0,d.jsx)(n.th,{children:"\u793a\u4f8b"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"200"}),(0,d.jsx)(n.td,{children:"\u6210\u529f"}),(0,d.jsx)(n.td,{children:"200 = \u64cd\u4f5c\u6210\u529f"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"400-499"}),(0,d.jsx)(n.td,{children:"\u5ba2\u6237\u7aef\u9519\u8bef"}),(0,d.jsx)(n.td,{children:"400=\u53c2\u6570\u9519\uff0c401=\u672a\u767b\u5f55\uff0c403=\u65e0\u6743\u9650\uff0c404=\u8d44\u6e90\u4e0d\u5b58\u5728"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"500-599"}),(0,d.jsx)(n.td,{children:"\u670d\u52a1\u7aef\u9519\u8bef"}),(0,d.jsx)(n.td,{children:"500=\u7cfb\u7edf\u9519\u8bef\uff0c503=\u670d\u52a1\u4e0d\u53ef\u7528"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"5001-5999"}),(0,d.jsx)(n.td,{children:"\u7528\u6237\u6a21\u5757\u4e1a\u52a1\u9519\u8bef"}),(0,d.jsx)(n.td,{children:"5001=\u7528\u6237\u4e0d\u5b58\u5728\uff0c5002=\u5bc6\u7801\u9519\u8bef"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"6001-6999"}),(0,d.jsx)(n.td,{children:"\u8ba2\u5355\u6a21\u5757\u4e1a\u52a1\u9519\u8bef"}),(0,d.jsx)(n.td,{children:"6001=\u8ba2\u5355\u4e0d\u5b58\u5728\uff0c6002=\u8ba2\u5355\u5df2\u652f\u4ed8"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"7001-7999"}),(0,d.jsx)(n.td,{children:"\u652f\u4ed8\u6a21\u5757\u4e1a\u52a1\u9519\u8bef"}),(0,d.jsx)(n.td,{children:"7001=\u4f59\u989d\u4e0d\u8db3\uff0c7002=\u652f\u4ed8\u8d85\u65f6"})]})]})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'public enum BizErrorCode {\n    // \u7528\u6237\u6a21\u5757 5001-5999\n    USER_NOT_FOUND(5001, "\u7528\u6237\u4e0d\u5b58\u5728"),\n    PASSWORD_ERROR(5002, "\u5bc6\u7801\u9519\u8bef"),\n    USER_DISABLED(5003, "\u7528\u6237\u5df2\u7981\u7528"),\n\n    // \u8ba2\u5355\u6a21\u5757 6001-6999\n    ORDER_NOT_FOUND(6001, "\u8ba2\u5355\u4e0d\u5b58\u5728"),\n    ORDER_ALREADY_PAID(6002, "\u8ba2\u5355\u5df2\u652f\u4ed8"),\n    ORDER_EXPIRED(6003, "\u8ba2\u5355\u5df2\u8fc7\u671f"),\n    STOCK_NOT_ENOUGH(6004, "\u5e93\u5b58\u4e0d\u8db3"),\n\n    // \u652f\u4ed8\u6a21\u5757 7001-7999\n    BALANCE_NOT_ENOUGH(7001, "\u4f59\u989d\u4e0d\u8db3"),\n    PAYMENT_TIMEOUT(7002, "\u652f\u4ed8\u8d85\u65f6");\n\n    private final int code;\n    private final String msg;\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"33-\u5206\u9875\u54cd\u5e94\u7ed3\u6784",children:"3.3 \u5206\u9875\u54cd\u5e94\u7ed3\u6784"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@Data\n@Schema(description = "\u5206\u9875\u54cd\u5e94")\npublic class PageInfo<T> {\n\n    @Schema(description = "\u5f53\u524d\u9875", example = "1")\n    private Integer pageNum;\n\n    @Schema(description = "\u6bcf\u9875\u6761\u6570", example = "10")\n    private Integer pageSize;\n\n    @Schema(description = "\u603b\u6761\u6570", example = "100")\n    private Long total;\n\n    @Schema(description = "\u603b\u9875\u6570", example = "10")\n    private Integer pages;\n\n    @Schema(description = "\u6570\u636e\u5217\u8868")\n    private List<T> list;\n\n    @Schema(description = "\u662f\u5426\u6709\u4e0b\u4e00\u9875", example = "true")\n    private Boolean hasNextPage;\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"34-\u54cd\u5e94\u793a\u4f8b",children:"3.4 \u54cd\u5e94\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'// \u6210\u529f\u54cd\u5e94\uff08\u5355\u6761\u6570\u636e\uff09\n{\n    "code": 200,\n    "msg": "\u6210\u529f",\n    "data": {\n        "orderId": 1001,\n        "orderNo": "202401010001",\n        "amount": 299.00,\n        "status": 1,\n        "createTime": "2024-01-01 12:00:00"\n    },\n    "timestamp": 1704067200000\n}\n\n// \u6210\u529f\u54cd\u5e94\uff08\u5206\u9875\u6570\u636e\uff09\n{\n    "code": 200,\n    "msg": "\u6210\u529f",\n    "data": {\n        "pageNum": 1,\n        "pageSize": 10,\n        "total": 100,\n        "pages": 10,\n        "list": [...],\n        "hasNextPage": true\n    },\n    "timestamp": 1704067200000\n}\n\n// \u5931\u8d25\u54cd\u5e94\n{\n    "code": 6001,\n    "msg": "\u8ba2\u5355\u4e0d\u5b58\u5728",\n    "data": null,\n    "timestamp": 1704067200000\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u56db\u5168\u5c40\u5f02\u5e38\u5904\u7406-must",children:"\u56db\u3001\u5168\u5c40\u5f02\u5e38\u5904\u7406 [MUST]"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@RestControllerAdvice\npublic class GlobalExceptionHandler {\n\n    // \u53c2\u6570\u6821\u9a8c\u5f02\u5e38\uff08@Valid\uff09\n    @ExceptionHandler(MethodArgumentNotValidException.class)\n    public Result<Void> handleValidException(MethodArgumentNotValidException e) {\n        String errorMsg = e.getBindingResult().getFieldErrors().stream()\n                .map(error -> error.getField() + ": " + error.getDefaultMessage())\n                .collect(Collectors.joining(", "));\n        return Result.fail(400, "\u53c2\u6570\u6821\u9a8c\u5931\u8d25: " + errorMsg);\n    }\n\n    // \u53c2\u6570\u6821\u9a8c\u5f02\u5e38\uff08@Validated\uff09\n    @ExceptionHandler(ConstraintViolationException.class)\n    public Result<Void> handleConstraintException(ConstraintViolationException e) {\n        String errorMsg = e.getConstraintViolations().stream()\n                .map(v -> v.getPropertyPath() + ": " + v.getMessage())\n                .collect(Collectors.joining(", "));\n        return Result.fail(400, "\u53c2\u6570\u6821\u9a8c\u5931\u8d25: " + errorMsg);\n    }\n\n    // \u4e1a\u52a1\u5f02\u5e38\n    @ExceptionHandler(BusinessException.class)\n    public Result<Void> handleBusinessException(BusinessException e) {\n        return Result.fail(e.getCode(), e.getMessage());\n    }\n\n    // \u672a\u77e5\u5f02\u5e38\n    @ExceptionHandler(Exception.class)\n    public Result<Void> handleException(Exception e) {\n        log.error("\u7cfb\u7edf\u5f02\u5e38", e);\n        return Result.fail(500, "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");\n    }\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u4e94\u63a5\u53e3\u6587\u6863\u89c4\u8303-must",children:"\u4e94\u3001\u63a5\u53e3\u6587\u6863\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"51-springdoc-\u914d\u7f6e",children:"5.1 SpringDoc \u914d\u7f6e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"springdoc:\n  api-docs:\n    enabled: true\n    path: /v3/api-docs\n  swagger-ui:\n    enabled: true\n    path: /swagger-ui.html\n  packages-to-scan: com.example.controller\n"})}),"\n",(0,d.jsx)(n.h3,{id:"52-controller-\u6587\u6863\u6ce8\u89e3",children:"5.2 Controller \u6587\u6863\u6ce8\u89e3"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("/api/v1/orders")\n@Tag(name = "\u8ba2\u5355\u63a5\u53e3", description = "\u8ba2\u5355 CRUD \u64cd\u4f5c")\npublic class OrderController {\n\n    @Operation(\n        summary = "\u521b\u5efa\u8ba2\u5355",\n        description = "\u7528\u6237\u4e0b\u5355\u63a5\u53e3\uff0c\u9700\u4f20\u5165\u7528\u6237 ID\u3001\u5546\u54c1\u5217\u8868\u3001\u91d1\u989d"\n    )\n    @ApiResponses({\n        @ApiResponse(responseCode = "200", description = "\u521b\u5efa\u6210\u529f"),\n        @ApiResponse(responseCode = "400", description = "\u53c2\u6570\u9519\u8bef"),\n        @ApiResponse(responseCode = "6004", description = "\u5e93\u5b58\u4e0d\u8db3")\n    })\n    @PostMapping\n    public Result<Long> createOrder(\n            @RequestBody @Valid OrderCreateRequest request) {\n        return Result.success(orderService.createOrder(request));\n    }\n\n    @Operation(summary = "\u67e5\u8be2\u8ba2\u5355\u8be6\u60c5")\n    @Parameter(name = "orderId", description = "\u8ba2\u5355 ID", required = true, example = "1001")\n    @GetMapping("/{orderId}")\n    public Result<OrderVO> getOrder(@PathVariable Long orderId) {\n        return Result.success(orderService.getOrderById(orderId));\n    }\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u516d\u7248\u672c\u63a7\u5236\u89c4\u8303-must",children:"\u516d\u3001\u7248\u672c\u63a7\u5236\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"61-\u7248\u672c\u7b56\u7565",children:"6.1 \u7248\u672c\u7b56\u7565"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"format: /api/v{major}/resource\nrules:\n  - \u4e3b\u7248\u672c\u53f7\u9012\u589e\u8868\u793a\u4e0d\u517c\u5bb9\u53d8\u66f4\n  - \u65b0\u589e\u5b57\u6bb5\u5fc5\u987b\u8bbe\u9ed8\u8ba4\u503c\n  - \u7981\u6b62\u5220\u9664\u65e7\u5b57\u6bb5\uff08\u6807\u8bb0\u5e9f\u5f03\uff09\n  - \u7981\u6b62\u4fee\u6539\u5b57\u6bb5\u7c7b\u578b\n"})}),"\n",(0,d.jsx)(n.h3,{id:"62-\u63a5\u53e3\u5e9f\u5f03\u6d41\u7a0b",children:"6.2 \u63a5\u53e3\u5e9f\u5f03\u6d41\u7a0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'// 1. \u6807\u8bb0\u5e9f\u5f03\n@Deprecated\n@Operation(summary = "\u3010\u5df2\u5e9f\u5f03\u3011\u67e5\u8be2\u8ba2\u5355", description = "\u8bf7\u4f7f\u7528 /api/v2/orders \u66ff\u4ee3")\n@GetMapping("/api/v1/orders/{orderId}")\npublic Result<OrderVO> getOrderV1(@PathVariable Long orderId) {\n    // ...\n}\n\n// 2. \u65b0\u7248\u672c\u63a5\u53e3\n@Operation(summary = "\u67e5\u8be2\u8ba2\u5355\u8be6\u60c5")\n@GetMapping("/api/v2/orders/{orderId}")\npublic Result<OrderDetailVO> getOrderV2(@PathVariable Long orderId) {\n    // ...\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u4e03\u5b89\u5168\u89c4\u8303-must",children:"\u4e03\u3001\u5b89\u5168\u89c4\u8303 [MUST]"}),"\n",(0,d.jsx)(n.h3,{id:"71-\u63a5\u53e3\u9650\u6d41",children:"7.1 \u63a5\u53e3\u9650\u6d41"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@SentinelResource(\n    value = "createOrder",\n    blockHandler = "createOrderBlockHandler"\n)\n@PostMapping\npublic Result<Long> createOrder(@RequestBody @Valid OrderCreateRequest request) {\n    return Result.success(orderService.createOrder(request));\n}\n\npublic Result<Long> createOrderBlockHandler(OrderCreateRequest request, BlockException e) {\n    return Result.fail(429, "\u8bf7\u6c42\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"72-\u5e42\u7b49\u6027\u8bbe\u8ba1",children:"7.2 \u5e42\u7b49\u6027\u8bbe\u8ba1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:'@PostMapping\npublic Result<Long> createOrder(\n        @RequestHeader("X-Request-Id") String requestId,\n        @RequestBody @Valid OrderCreateRequest request) {\n\n    // \u5e42\u7b49\u68c0\u67e5\n    String key = "idempotent:order:" + requestId;\n    Boolean isNew = redisTemplate.opsForValue()\n        .setIfAbsent(key, "1", 30, TimeUnit.MINUTES);\n    if (Boolean.FALSE.equals(isNew)) {\n        throw new BusinessException("\u8bf7\u52ff\u91cd\u590d\u63d0\u4ea4");\n    }\n\n    return Result.success(orderService.createOrder(request));\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"73-\u654f\u611f\u6570\u636e\u8131\u654f",children:"7.3 \u654f\u611f\u6570\u636e\u8131\u654f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-java",children:"@Data\npublic class UserVO {\n    private Long userId;\n    private String userName;\n\n    @JsonSerialize(using = PhoneDesensitizer.class)\n    private String phone;  // 138****8000\n\n    @JsonSerialize(using = IdCardDesensitizer.class)\n    private String idCard;  // 310***********1234\n}\n"})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"\u516b\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355",children:"\u516b\u3001\u53cd\u6a21\u5f0f\u68c0\u67e5\u6e05\u5355"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u5e8f\u53f7"}),(0,d.jsx)(n.th,{children:"\u53cd\u6a21\u5f0f"}),(0,d.jsx)(n.th,{children:"\u68c0\u6d4b\u65b9\u5f0f"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"URL \u5305\u542b\u52a8\u8bcd"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 RequestMapping \u8def\u5f84"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"GET \u8bf7\u6c42\u5e26 RequestBody"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 GET \u65b9\u6cd5\u53c2\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"\u65e0\u7edf\u4e00\u54cd\u5e94\u683c\u5f0f"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5\u8fd4\u56de\u7c7b\u578b\u662f\u5426\u4e3a Result"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"\u65e0\u53c2\u6570\u6821\u9a8c\u6ce8\u89e3"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 @Valid/@Validated"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"5"}),(0,d.jsx)(n.td,{children:"\u65e0\u5168\u5c40\u5f02\u5e38\u5904\u7406"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 @RestControllerAdvice"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"6"}),(0,d.jsx)(n.td,{children:"\u65e0\u63a5\u53e3\u6587\u6863\u6ce8\u89e3"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 @Operation/@Tag"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"7"}),(0,d.jsx)(n.td,{children:"\u65e0\u7248\u672c\u53f7"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 URL \u662f\u5426\u5305\u542b /v1/"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"8"}),(0,d.jsx)(n.td,{children:"\u54cd\u5e94\u5305\u542b\u654f\u611f\u6570\u636e"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5 password/secret \u7b49\u5b57\u6bb5"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"9"}),(0,d.jsx)(n.td,{children:"POST \u63a5\u53e3\u65e0\u5e42\u7b49\u8bbe\u8ba1"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5\u521b\u5efa\u7c7b\u63a5\u53e3"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"10"}),(0,d.jsx)(n.td,{children:"\u65e0\u5206\u9875\u53c2\u6570"}),(0,d.jsx)(n.td,{children:"\u68c0\u67e5\u5217\u8868\u67e5\u8be2\u63a5\u53e3"})]})]})]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>l});var s=r(6540);const d={},i=s.createContext(d);function t(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);